[
{
	"uri": "/docs-sat/en-24/dashboards/",
	"title": "SAT Dashboards",
	"tags": [],
	"description": "",
	"content": "SAT Dashboards SAT Kibana Dashboards SAT Grafana Dashboards "
},
{
	"uri": "/docs-sat/en-24/install/",
	"title": "SAT Installation",
	"tags": [],
	"description": "",
	"content": "SAT Installation Install the System Admin Toolkit Product Stream Describes how to install or upgrade the System Admin Toolkit (SAT) product stream.\nPrerequisites CSM is installed and verified. There must be at least 2 gigabytes of free space on the manager NCN on which the procedure is run. Notes on the Procedures Ellipses (...) in shell output indicate omitted lines.\nIn the examples below, replace x.y.z with the version of the SAT product stream being installed.\n\u0026lsquo;manager\u0026rsquo; and \u0026lsquo;master\u0026rsquo; are used interchangeably in the steps below.\nTo upgrade SAT, execute the pre-installation, installation, and post-installation procedures for a newer distribution. The newly installed version will become the default.\nIn SAT 2.4, you can instead upgrade the product stream by using the Compute Node Environment (CNE) installer. It is recommended that you upgrade SAT with the CNE installer because the process is both automated and logged to help you save time. For more information, see SAT Upgrade with CNE Installer.\nPre-Installation Procedure Start a typescript and set the shell prompt.\nThe typescript will record the commands and the output from this installation. The prompt is set to include the date and time.\nncn-m001# script -af product-sat.$(date +%Y-%m-%d).txt ncn-m001# export PS1=\u0026#39;\\u@\\H \\D{%Y-%m-%d} \\t \\w # \u0026#39; Installation Procedure Copy the release distribution gzipped tar file to ncn-m001.\nUnzip and extract the release distribution.\nncn-m001# tar -xvzf sat-x.y.z.tar.gz Change directory to the extracted release distribution directory.\nncn-m001# cd sat-x.y.z Run the installer: install.sh.\nThe script produces a lot of output. A successful install ends with \u0026ldquo;SAT version x.y.z has been installed\u0026rdquo;, where x.y.z is the SAT product version.\nncn-m001# ./install.sh ====\u0026gt; Installing System Admin Toolkit version x.y.z ... ====\u0026gt; Waiting 300 seconds for sat-config-import-x.y.z to complete ... ====\u0026gt; SAT version x.y.z has been installed. Optional: Stop the typescript.\nNOTE: This step can be skipped if you wish to use the same typescript for the remainder of the SAT install (see Next Steps).\nncn-m001# exit SAT version x.y.z is now installed/upgraded, meaning the SAT x.y.z release has been loaded into the system software repository.\nSAT configuration content for this release has been uploaded to VCS. SAT content for this release has been uploaded to the CSM product catalog. SAT content for this release has been uploaded to Nexus repositories. The sat command won\u0026rsquo;t be available until the NCN Personalization procedure has been executed. Next Steps If other HPE Cray EX software products are being installed or upgraded in conjunction with SAT, refer to the HPE Cray EX System Software Getting Started Guide (S-8000) to determine which step to execute next.\nIf no other HPE Cray EX software products are being installed or upgraded at this time, proceed to the sections listed below.\nNOTE: The procedures in Configure SAT are only required during the first installation of SAT. However, the NCN Personalization procedure is required both when installing and upgrading SAT.\nIf performing a fresh install, execute the Configure SAT procedures:\nSAT Authentication Generate SAT S3 Credentials Set System Revision Information Execute the NCN Personalization procedure:\nPerform NCN Personalization If performing an upgrade, execute the SAT Post-Upgrade procedures:\nRemove obsolete configuration file sections SAT Logging Set System Revision Information NOTE: The Set System Revision Information procedure is not required after upgrading from SAT 2.1 or later.\nConfigure SAT SAT Authentication Initially, as part of the installation and configuration, SAT authentication is set up so SAT commands can be used in later steps of the install process. The admin account used to authenticate with sat auth must be enabled in Keycloak and must have its assigned role set to admin. For instructions on editing Role Mappings see Create Internal User Accounts in the Keycloak Shasta Realm in the CSM product documentation. For additional information on SAT authentication, see System Security and Authentication in the CSM documentation.\nNOTE: This procedure is only required after initially installing SAT. It is not required after upgrading SAT.\nDescription of SAT Command Authentication Types Some SAT subcommands make requests to the Shasta services through the API gateway and thus require authentication to the API gateway in order to function. Other SAT subcommands use the Kubernetes API. Some sat commands require S3 to be configured (see: Generate SAT S3 Credentials). In order to use the SAT S3 bucket, the System Administrator must generate the S3 access key and secret keys and write them to a local file. This must be done on every Kubernetes manager node where SAT commands are run.\nBelow is a table describing SAT commands and the types of authentication they require.\nSAT Subcommand Authentication/Credentials Required Man Page Description sat auth Responsible for authenticating to the API gateway and storing a token. sat-auth Authenticate to the API gateway and save the token. sat bmccreds Requires authentication to the API gateway. sat-bmccreds Set BMC passwords. sat bootprep Requires authentication to the API gateway. Requires Kubernetes configuration and authentication, which is done on ncn-m001 during the install. sat-bootprep Prepare to boot nodes with images and configurations. sat bootsys Requires authentication to the API gateway. Requires Kubernetes configuration and authentication, which is configured on ncn-m001 during the install. Some stages require passwordless SSH to be configured to all other NCNs. Requires S3 to be configured for some stages. sat-bootsys Boot or shutdown the system, including compute nodes, application nodes, and non-compute nodes (NCNs) running the management software. sat diag Requires authentication to the API gateway. sat-diag Launch diagnostics on the HSN switches and generate a report. sat firmware Requires authentication to the API gateway. sat-firmware Report firmware version. sat hwhist Requires authentication to the API gateway. sat-hwhist Report hardware component history. sat hwinv Requires authentication to the API gateway. sat-hwinv Give a listing of the hardware of the HPE Cray EX system. sat hwmatch Requires authentication to the API gateway. sat-hwmatch Report hardware mismatches. sat init None sat-init Create a default SAT configuration file. sat k8s Requires Kubernetes configuration and authentication, which is automatically configured on ncn-m001 during the install. sat-k8s Report on Kubernetes replica sets that have co-located (on the same node) replicas. sat linkhealth This command has been deprecated. sat nid2xname Requires authentication to the API gateway. sat-nid2xname Translate node IDs to node XNames. sat sensors Requires authentication to the API gateway. sat-sensors Report current sensor data. sat setrev Requires S3 to be configured for site information such as system name, serial number, install date, and site name. sat-setrev Set HPE Cray EX system revision information. sat showrev Requires API gateway authentication in order to query the Interconnect from HSM. Requires S3 to be configured for site information such as system name, serial number, install date, and site name. sat-showrev Print revision information for the HPE Cray EX system. sat slscheck Requires authentication to the API gateway. sat-slscheck Perform a cross-check between SLS and HSM. sat status Requires authentication to the API gateway. sat-status Report node status across the HPE Cray EX system. sat swap Requires authentication to the API gateway. sat-swap Prepare HSN switch or cable for replacement and bring HSN switch or cable into service. sat xname2nid Requires authentication to the API gateway. sat-xname2nid Translate node and node BMC XNames to node IDs. sat switch This command has been deprecated. It has been replaced by sat swap. In order to authenticate to the API gateway, you must run the sat auth command. This command will prompt for a password on the command line. The username value is obtained from the following locations, in order of higher precedence to lower precedence:\nThe --username global command-line option. The username option in the api_gateway section of the config file at ~/.config/sat/sat.toml. The name of currently logged in user running the sat command. If credentials are entered correctly when prompted by sat auth, a token file will be obtained and saved to ~/.config/sat/tokens. Subsequent sat commands will determine the username the same way as sat auth described above, and will use the token for that username if it has been obtained and saved by sat auth.\nPrerequisites The sat CLI has been installed following Install The System Admin Toolkit Product Stream. Procedure The following is the procedure to globally configure the username used by SAT and authenticate to the API gateway:\nGenerate a default SAT configuration file, if one does not exist.\nncn-m001# sat init Configuration file \u0026#34;/root/.config/sat/sat.toml\u0026#34; generated. Note: If the config file already exists, it will print out an error:\nERROR: Configuration file \u0026#34;/root/.config/sat/sat.toml\u0026#34; already exists. Not generating configuration file. Edit ~/.config/sat/sat.toml and set the username option in the api_gateway section of the config file. For example:\nusername = \u0026#34;crayadmin\u0026#34; Run sat auth. Enter your password when prompted. For example:\nncn-m001# sat auth Password for crayadmin: Succeeded! Other sat commands are now authenticated to make requests to the API gateway. For example:\nncn-m001# sat status Generate SAT S3 Credentials Generate S3 credentials and write them to a local file so the SAT user can access S3 storage. In order to use the SAT S3 bucket, the System Administrator must generate the S3 access key and secret keys and write them to a local file. This must be done on every Kubernetes master node where SAT commands are run.\nSAT uses S3 storage for several purposes, most importantly to store the site-specific information set with sat setrev (see: Set System Revision Information).\nNOTE: This procedure is only required after initially installing SAT. It is not required after upgrading SAT.\nPrerequisites The SAT CLI has been installed following Install The System Admin Toolkit Product Stream The SAT configuration file has been created (See SAT Authentication). CSM has been installed and verified. Procedure Ensure the files are readable only by root.\nncn-m001# touch /root/.config/sat/s3_access_key \\ /root/.config/sat/s3_secret_key ncn-m001# chmod 600 /root/.config/sat/s3_access_key \\ /root/.config/sat/s3_secret_key Write the credentials to local files using kubectl.\nncn-m001# kubectl get secret sat-s3-credentials -o json -o \\ jsonpath=\u0026#39;{.data.access_key}\u0026#39; | base64 -d \u0026gt; \\ /root/.config/sat/s3_access_key ncn-m001# kubectl get secret sat-s3-credentials -o json -o \\ jsonpath=\u0026#39;{.data.secret_key}\u0026#39; | base64 -d \u0026gt; \\ /root/.config/sat/s3_secret_key Verify the S3 endpoint specified in the SAT configuration file is correct.\nGet the SAT configuration file\u0026rsquo;s endpoint value.\nNOTE: If the command\u0026rsquo;s output is commented out, indicated by an initial # character, the SAT configuration will take the default value – \u0026quot;https://rgw-vip.nmn\u0026quot;.\nncn-m001# grep endpoint ~/.config/sat/sat.toml # endpoint = \u0026#34;https://rgw-vip.nmn\u0026#34; Get the sat-s3-credentials secret\u0026rsquo;s endpoint value.\nncn-m001# kubectl get secret sat-s3-credentials -o json -o \\ jsonpath=\u0026#39;{.data.s3_endpoint}\u0026#39; | base64 -d | xargs https://rgw-vip.nmn Compare the two endpoint values.\nIf the values differ, change the SAT configuration file\u0026rsquo;s endpoint value to match the secret\u0026rsquo;s.\nCopy SAT configurations to each manager node on the system.\nncn-m001# for i in ncn-m002 ncn-m003; do echo $i; ssh ${i} \\ mkdir -p /root/.config/sat; \\ scp -pr /root/.config/sat ${i}:/root/.config; done NOTE: Depending on how many manager nodes are on the system, the list of manager nodes may be different. This example assumes three manager nodes, where the configuration files must be copied from ncn-m001 to ncn-m002 and ncn-m003. Therefore, the list of hosts above is ncn-m002 and ncn-m003.\nSet System Revision Information HPE service representatives use system revision information data to identify systems in support cases.\nPrerequisites SAT authentication has been set up. See SAT Authentication. S3 credentials have been generated. See Generate SAT S3 Credentials. Notes on the Procedure This procedure is required after a fresh install of SAT. After an upgrade of SAT, this procedure is not required if SAT was upgraded from 2.1 (Shasta v1.5) or later. It is required if SAT was upgraded from 2.0 (Shasta v1.4) or earlier. Procedure Set System Revision Information.\nRun sat setrev and follow the prompts to set the following site-specific values:\nSerial number System name System type System description Product number Company name Site name Country code System install date TIP: For \u0026ldquo;System type\u0026rdquo;, a system with any liquid-cooled components should be considered a liquid-cooled system. In other words, \u0026ldquo;System type\u0026rdquo; is EX-1C.\nncn-m001# sat setrev -------------------------------------------------------------------------------- Setting: Serial number Purpose: System identification. This will affect how snapshots are identified in the HPE backend services. Description: This is the top-level serial number which uniquely identifies the system. It can be requested from an HPE representative. Valid values: Alpha-numeric string, 4 - 20 characters. Type: \u0026lt;class \u0026#39;str\u0026#39;\u0026gt; Default: None Current value: None -------------------------------------------------------------------------------- Please do one of the following to set the value of the above setting: - Input a new value - Press CTRL-C to exit ... Verify System Revision Information.\nRun sat showrev and verify the output shown in the \u0026ldquo;System Revision Information table.\u0026rdquo;\nThe following example shows sample table output.\nncn-m001# sat showrev ################################################################################ System Revision Information ################################################################################ +---------------------+---------------+ | component | data | +---------------------+---------------+ | Company name | HPE | | Country code | US | | Interconnect | Sling | | Product number | R4K98A | | Serial number | 12345 | | Site name | HPE | | Slurm version | slurm 20.02.5 | | System description | Test System | | System install date | 2021-01-29 | | System name | eniac | | System type | EX-1C | +---------------------+---------------+ ################################################################################ Product Revision Information ################################################################################ +--------------+-----------------+------------------------------+------------------------------+ | product_name | product_version | images | image_recipes | +--------------+-----------------+------------------------------+------------------------------+ | csm | 0.8.14 | cray-shasta-csm-sles15sp1... | cray-shasta-csm-sles15sp1... | | sat | 2.0.1 | - | - | | sdu | 1.0.8 | - | - | | slingshot | 0.8.0 | - | - | | sma | 1.4.12 | - | - | +--------------+-----------------+------------------------------+------------------------------+ ################################################################################ Local Host Operating System ################################################################################ +-----------+----------------------+ | component | version | +-----------+----------------------+ | Kernel | 5.3.18-24.15-default | | SLES | SLES 15-SP2 | +-----------+----------------------+ Perform NCN Personalization A new CFS configuration layer must be added to the CFS configuration used on management NCNs. It is required following SAT installation and configuration. This procedure describes how to add that layer.\nPrerequisites The Install the System Admin Toolkit Product Stream procedure has been successfully completed. If performing a fresh install, the Configure SAT procedures have been successfully completed. Notes on the Procedure Ellipses (...) in shell output indicate omitted lines. In the examples below, replace x.y.z with the version of the SAT product stream being installed. \u0026lsquo;manager\u0026rsquo; and \u0026lsquo;master\u0026rsquo; are used interchangeably in the steps below. If upgrading SAT, the existing configuration will likely include other Cray EX product entries. Update the SAT entry as described in this procedure. The HPE Cray EX System Software Getting Started Guide (S-8000) provides guidance on how and when to update the entries for the other products. Pre-NCN-Personalization Procedure Start a typescript if not already using one, and set the shell prompt.\nThe typescript will record the commands and the output from this installation. The prompt is set to include the date and time.\nncn-m001# script -af product-sat.$(date +%Y-%m-%d).txt ncn-m001# export PS1=\u0026#39;\\u@\\H \\D{%Y-%m-%d} \\t \\w # \u0026#39; Procedure to Update CFS Configuration The SAT release distribution includes a script, update-mgmt-ncn-cfs-config.sh, that updates a CFS configuration to include the SAT layer required to install and configure SAT on the management NCNs.\nThe script supports modifying a named CFS configuration in CFS, a CFS configuration defined in a JSON file, or the CFS configuration currently applied to particular components in CFS.\nThe script also includes options for specifying:\nhow the modified CFS configuration should be saved. the git commit hash or branch specified in the SAT layer. This procedure is split into three alternatives, which cover common use cases:\nUpdate Active CFS Configuration Update CFS Configuration in a JSON File Update Existing CFS Configuration by Name If none of these alternatives fit your use case, see Advanced Options for Updating CFS Configurations.\nUpdate Active CFS Configuration Use this alternative if there is already a CFS configuration assigned to the management NCNs and you would like to update it in place for the new version of SAT.\nRun the script with the following options:\nncn-m001# ./update-mgmt-ncn-cfs-config.sh --base-query role=Management,type=Node --save Examine the output to ensure the CFS configuration was updated.\nFor example, if there is a single CFS configuration that applies to NCNs, and if that configuration does not have a layer yet for any version of SAT, the output will look like this:\n====\u0026gt; Updating CFS configuration(s) INFO: Querying CFS configurations for the following NCNs: x3000c0s1b0n0, ..., x3000c0s9b0n0 INFO: Found configuration \u0026#34;ncn-personalization\u0026#34; for component x3000c0s1b0n0 ... INFO: Found configuration \u0026#34;ncn-personalization\u0026#34; for component x3000c0s9b0n0 ... INFO: No layer with repo path /vcs/cray/sat-config-management.git and playbook sat-ncn.yml found. INFO: Adding a layer with repo path /vcs/cray/sat-config-management.git and playbook sat-ncn.yml to the end. INFO: Successfully saved CFS configuration \u0026#34;ncn-personalization\u0026#34; INFO: Successfully saved 1 changed CFS configurations. ====\u0026gt; Completed CFS configuration(s) ====\u0026gt; Cleaning up install dependencies Alternatively, if the CFS configuration already contains a layer for SAT that just needs to be updated, the output will look like this:\n====\u0026gt; Updating CFS configuration(s) INFO: Querying CFS configurations for the following NCNs: x3000c0s1b0n0, ..., x3000c0s9b0n0 INFO: Found configuration \u0026#34;ncn-personalization\u0026#34; for component x3000c0s1b0n0 ... INFO: Found configuration \u0026#34;ncn-personalization\u0026#34; for component x3000c0s9b0n0 ... INFO: Updating existing layer with repo path /vcs/cray/sat-config-management.git and playbook sat-ncn.yml INFO: Property \u0026#34;commit\u0026#34; of layer with repo path /vcs/cray/sat-config-management.git and playbook sat-ncn.yml updated from 01ae28c92b9b4740e9e0e01ae01216c6c2d89a65 to bcbd6db0803cc4137c7558df9546b0faab303cbd INFO: Property \u0026#34;name\u0026#34; of layer with repo path /vcs/cray/sat-config-management.git and playbook sat-ncn.yml updated from sat-2.2.16 to sat-sat-ncn-bcbd6db-20220608T170152 INFO: Successfully saved CFS configuration \u0026#34;ncn-personalization\u0026#34; INFO: Successfully saved 1 changed CFS configurations. ====\u0026gt; Completed CFS configuration(s) ====\u0026gt; Cleaning up install dependencies Update CFS Configuration in a JSON File Use this alternative if you are constructing a new CFS configuration for management NCNs in a JSON file.\nRun the script with the following options, where JSON_FILE is an environment variable set to the path of the JSON file to modify:\nncn-m001# ./update-mgmt-ncn-cfs-config.sh --base-file $JSON_FILE --save Examine the output to ensure the JSON file was updated.\nFor example, if the configuration defined in the JSON file does not have a layer yet for any version of SAT, the output will look like this:\n====\u0026gt; Updating CFS configuration(s) INFO: No layer with repo path /vcs/cray/sat-config-management.git and playbook sat-ncn.yml found. INFO: Adding a layer with repo path /vcs/cray/sat-config-management.git and playbook sat-ncn.yml to the end. INFO: Successfully saved 1 changed CFS configurations. ====\u0026gt; Completed CFS configuration(s) ====\u0026gt; Cleaning up install dependencies Update Existing CFS Configuration by Name Use this alternative if you are updating a specific named CFS configuration. This may be the case if you are constructing a new CFS configuration during an install or upgrade of multiple products.\nRun the script with the following options, where CFS_CONFIG_NAME is an environment variable set to the name of the CFS configuration to update.\nncn-m001# ./update-mgmt-ncn-cfs-config.sh --base-config $CFS_CONFIG_NAME --save Examine the output to ensure the CFS configuration was updated.\nFor example, if the CFS configuration does not have a layer yet for any version of SAT, the output will look like this:\n====\u0026gt; Updating CFS configuration(s) INFO: No layer with repo path /vcs/cray/sat-config-management.git and playbook sat-ncn.yml found. INFO: Adding a layer with repo path /vcs/cray/sat-config-management.git and playbook sat-ncn.yml to the end. INFO: Successfully saved CFS configuration \u0026#34;CFS_CONFIG_NAME\u0026#34; INFO: Successfully saved 1 changed CFS configurations. ====\u0026gt; Completed CFS configuration(s) ====\u0026gt; Cleaning up install dependencies Advanced Options for Updating CFS Configurations If none of the alternatives described in the previous sections apply, view the full description of the options accepted by the update-mgmt-ncn-cfs-config.sh script by invoking it with the --help option.\nncn-m001# ./update-mgmt-ncn-cfs-config.sh --help Procedure to Apply CFS Configuration After the CFS configuration that applies to management NCNs has been updated as described in the Procedure to Update CFS Configuration, execute the following steps to ensure the modified CFS configuration is re-applied to the management NCNs.\nSet an environment variable that refers to the name of the CFS configuration to be applied to the management NCNs.\nncn-m001# export CFS_CONFIG_NAME=\u0026#34;ncn-personalization\u0026#34; Note: If the Update Active CFS Configuration section was followed above, the name of the updated CFS configuration will have been logged in the following format. If multiple CFS configurations were modified, any one of them can be used in this procedure.\nINFO: Successfully saved CFS configuration \u0026#34;ncn-personalization\u0026#34; Obtain the name of the CFS configuration layer for SAT and save it in an environment variable:\nncn-m001# export SAT_LAYER_NAME=$(cray cfs configurations describe $CFS_CONFIG_NAME --format json \\ | jq -r \u0026#39;.layers | map(select(.cloneUrl | contains(\u0026#34;sat-config-management.git\u0026#34;)))[0].name\u0026#39;) Create a CFS session that executes only the SAT layer of the given CFS configuration.\nThe --configuration-limit option limits the configuration session to run only the SAT layer of the configuration.\nncn-m001# cray cfs sessions create --name \u0026#34;sat-session-${CFS_CONFIG_NAME}\u0026#34; --configuration-name \\ \u0026#34;${CFS_CONFIG_NAME}\u0026#34; --configuration-limit \u0026#34;${SAT_LAYER_NAME}\u0026#34; Monitor the progress of the CFS session.\nSet an environment variable to name of the Ansible container within the pod for the CFS session:\nncn-m001# export ANSIBLE_CONTAINER=$(kubectl get pod -n services \\ --selector=cfsession=sat-session-${CFS_CONFIG_NAME} -o json \\ -o json | jq -r \u0026#39;.items[0].spec.containers | map(select(.name | contains(\u0026#34;ansible\u0026#34;))) | .[0].name\u0026#39;) Next, get the logs for the Ansible container.\nncn-m001# kubectl logs -c $ANSIBLE_CONTAINER --tail 100 -f -n services \\ --selector=cfsession=sat-session-${CFS_CONFIG_NAME} Ansible plays, which are run by the CFS session, will install SAT on all the master management NCNs on the system. A summary of results can be found at the end of the log output. The following example shows a successful session.\n... PLAY RECAP ********************************************************************* x3000c0s1b0n0 : ok=3 changed=3 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 x3000c0s3b0n0 : ok=3 changed=3 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 x3000c0s5b0n0 : ok=3 changed=3 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 NOTE: Ensure that the PLAY RECAPs for each session show successes for all manager NCNs before proceeding.\nVerify that SAT was successfully configured.\nIf sat is configured, the --version command will indicate which version is installed. If sat is not properly configured, the command will fail.\nNOTE: This version number will differ from the version number of the SAT release distribution. This is the semantic version of the sat Python package, which is different from the version number of the overall SAT release distribution.\nncn-m001# sat --version sat 3.7.0 NOTE: Upon first running sat, you may see additional output while the sat container image is downloaded. This will occur the first time sat is run on each manager NCN. For example, if you run sat for the first time on ncn-m001 and then for the first time on ncn-m002, you will see this additional output both times.\nTrying to pull registry.local/cray/cray-sat:3.7.0-20210514024359_9fed037... Getting image source signatures Copying blob da64e8df3afc done Copying blob 0f36fd81d583 done Copying blob 12527cf455ba done ... sat 3.7.0 Stop the typescript.\nncn-m001# exit SAT version x.y.z is now installed and configured:\nThe SAT RPM package is installed on the associated NCNs. Note on Procedure to Apply CFS Configuration The previous procedure is not always necessary because the CFS Batcher service automatically detects configuration changes and will automatically create new sessions to apply configuration changes according to certain rules. For more information on these rules, refer to Configuration Management with the CFS Batcher in the Cray System Management Documentation.\nThe main scenario in which the CFS batcher will not automatically re-apply the SAT layer is when the commit hash of the sat-config-management git repository has not changed between SAT versions. The previous procedure ensures the configuration is re-applied in all cases, and it is harmless if the batcher has already applied an updated configuration.\nNext Steps At this point, the release distribution files can be removed from the system as described in Post-Installation Cleanup Procedure.\nIf other HPE Cray EX software products are being installed or upgraded in conjunction with SAT, refer to the HPE Cray EX System Software Getting Started Guide (S-8000) to determine which step to execute next.\nIf no other HPE Cray EX software products are being installed at this time, the installation process is complete. If no other HPE Cray EX software products are being upgraded at this time, proceed to the remaining SAT Post-Upgrade procedures:\nRemove obsolete configuration file sections SAT Logging Set System Revision Information NOTE: The Set System Revision Information procedure is not required after upgrading from SAT 2.1 or later.\nPost-Installation Cleanup Procedure Optional: Remove the SAT release distribution tar file and extracted directory.\nncn-m001# rm sat-x.y.z.tar.gz ncn-m001# rm -rf sat-x.y.z/ SAT Post-Upgrade Remove Obsolete Configuration File Sections Prerequisites The Install the System Admin Toolkit Product Stream procedure has been successfully completed. The Perform NCN Personalization procedure has been successfully completed. Procedure After upgrading SAT, if using the configuration file from a previous version, there may be configuration file sections no longer used in the new version. For example, when upgrading from Shasta 1.4 to Shasta 1.5, the [redfish] configuration file section is no longer used. In that case, the following warning may appear upon running sat commands.\nWARNING: Ignoring unknown section \u0026#39;redfish\u0026#39; in config file. Remove the [redfish] section from /root/.config/sat/sat.toml to resolve the warning.\n[redfish] username = \u0026#34;admin\u0026#34; password = \u0026#34;adminpass\u0026#34; Repeat this process for any configuration file sections for which there are \u0026ldquo;unknown section\u0026rdquo; warnings.\nSAT Logging As of SAT version 2.2, some command output that was previously printed to stdout is now logged to stderr. These messages are logged at the INFO level. The default logging threshold was changed from WARNING to INFO to accommodate this logging change. Additionally, some messages previously logged at the INFO are now logged at the DEBUG level.\nThese changes take effect automatically. However, if the default output threshold has been manually set in ~/.config/sat/sat.toml, it should be changed to ensure that important output is shown in the terminal.\nUpdate Configuration In the following example, the stderr log level, logging.stderr_level, is set to WARNING, which will exclude INFO-level logging from terminal output.\nncn-m001:~ # grep -A 3 logging ~/.config/sat/sat.toml [logging] ... stderr_level = \u0026#34;WARNING\u0026#34; To enable the new default behavior, comment this line out, delete it, or set the value to \u0026ldquo;INFO\u0026rdquo;.\nIf logging.stderr_level is commented out, its value will not affect logging behavior. However, it may be helpful set its value to INFO as a reminder of the new default behavior.\nAffected Commands The following commands trigger messages that have been changed from stdout print calls to INFO-level (or WARNING- or ERROR-level) log messages:\nsat bootsys --stage shutdown --stage session-checks sat sensors The following commands trigger messages that have been changed from INFO-level log messages to DEBUG-level log messages:\nsat nid2xname sat xname2nid sat swap SAT Uninstall and Downgrade Uninstall: Removing a Version of SAT This procedure can be used to uninstall a version of SAT.\nPrerequisites Only versions 2.2 or newer of SAT can be uninstalled with prodmgr. CSM version 1.2 or newer must be installed, so that the prodmgr command is available. Procedure Use sat showrev to list versions of SAT.\nNOTE: It is not recommended to uninstall a version designated as \u0026ldquo;active\u0026rdquo;. If the active version is uninstalled, then the activate procedure must be executed on a remaining version.\nncn-m001# sat showrev --products --filter product_name=sat ############################################################################### Product Revision Information ############################################################################### +--------------+-----------------+--------+-------------------+-----------------------+ | product_name | product_version | active | images | image_recipes | +--------------+-----------------+--------+-------------------+-----------------------+ | sat | 2.3.3 | True | - | - | | sat | 2.2.10 | False | - | - | +--------------+-----------------+--------+-------------------+-----------------------+ Use prodmgr to uninstall a version of SAT.\nThis command will do three things:\nRemove all hosted-type package repositories associated with the given version of SAT. Group-type repositories are not removed. Remove all container images associated with the given version of SAT. Remove SAT from the cray-product-catalog Kubernetes ConfigMap, so that it will no longer show up in the output of sat showrev. ncn-m001# prodmgr uninstall sat 2.2.10 Repository sat-2.2.10-sle-15sp2 has been removed. Removed Docker image cray/cray-sat:3.9.0 Removed Docker image cray/sat-cfs-install:1.0.2 Removed Docker image cray/sat-install-utility:1.4.0 Deleted sat-2.2.10 from product catalog. Activate: Switching Between Versions This procedure can be used to downgrade the active version of SAT.\nPrerequisites Only versions 2.2 or newer of SAT can be activated. Older versions must be activated manually. CSM version 1.2 or newer must be installed, so that the prodmgr command is available. Procedure Use sat showrev to list versions of SAT.\nncn-m001# sat showrev --products --filter product_name=sat ############################################################################### Product Revision Information ############################################################################### +--------------+-----------------+--------+--------------------+-----------------------+ | product_name | product_version | active | images | image_recipes | +--------------+-----------------+--------+--------------------+-----------------------+ | sat | 2.3.3 | True | - | - | | sat | 2.2.10 | False | - | - | +--------------+-----------------+--------+--------------------+-----------------------+ Use prodmgr to activate a different version of SAT.\nThis command will do three things:\nFor all hosted-type package repositories associated with this version of SAT, set them as the sole member of their corresponding group-type repository. For example, activating SAT version 2.2.10 sets the repository sat-2.2.10-sle-15sp2 as the only member of the sat-sle-15sp2 group. Set the version 2.2.10 as active within the product catalog, so that it appears active in the output of sat showrev. Ensure that the SAT CFS configuration content exists as a layer in all CFS configurations that are associated with NCNs with the role \u0026ldquo;Management\u0026rdquo; and subrole \u0026ldquo;Master\u0026rdquo; (for example, the CFS configuration ncn-personalization). Specifically, it will ensure that the layer refers to the version of SAT CFS configuration content associated with the version of SAT being activated. ncn-m001# prodmgr activate sat 2.2.10 Repository sat-2.2.10-sle-15sp2 is now the default in sat-sle-15sp2. Set sat-2.2.10 as active in product catalog. Updated CFS configurations: [ncn-personalization] Verify that the chosen version is marked as active.\nncn-m001# sat showrev --products --filter product_name=sat ############################################################################### Product Revision Information ############################################################################### +--------------+-----------------+--------+--------------------+-----------------------+ | product_name | product_version | active | images | image_recipes | +--------------+-----------------+--------+--------------------+-----------------------+ | sat | 2.3.3 | False | - | - | | sat | 2.2.10 | True | - | - | +--------------+-----------------+--------+--------------------+-----------------------+ Apply the modified CFS configuration to the management NCNs.\nAt this point, Nexus package repositories have been modified to set a particular package repository as active, but the SAT package may not have been updated on management NCNs.\nTo ensure that management NCNs have been updated to use the active SAT version, follow the Procedure to Apply CFS Configuration. Refer to the output from the prodmgr activate command to find the name of the modified CFS configuration. If more than one CFS configuration was modified, use the first one.\nOptional: Installing and Configuring SAT on an External System SAT can optionally be installed and configured on an external system to interact with CSM over the CAN.\nLimitations Most SAT subcommands work by accessing APIs which are reachable via the CAN. However, certain SAT commands depend on host-based functionality on the management NCNs and will not work from an external system. This includes the following:\nThe platform-services and ncn-power stages of sat bootsys The local host information displayed by the --local option of sat showrev Installing SAT on an external system is not an officially supported configuration. These instructions are provided \u0026ldquo;as-is\u0026rdquo; with the hope that they can useful for users who desire additional flexibility.\nCertain additional steps may need to be taken to install and configure SAT depending on the configuration of the external system in use. These additional steps may include provisioning virtual machines, installing packages, or configuring TLS certificates, and these steps are outside the scope of this documentation. This section covers only the steps needed to configure SAT to use externally-accessible API endpoints exposed by CSM.\nPrerequisites The external system must be on the Customer Access Network (CAN). Python 3.7 or newer is installed on the system. kubectl, openssh, git, and curl are installed on the external system. The root CA certificates used when installing CSM have been added to the external system\u0026rsquo;s trust store such that authenticated TLS connections can be made to the CSM REST API gateway. For more information, refer to Certificate Authority in the Cray System Management Documentation. Procedure Create a Python virtual environment.\n$ SAT_VENV_PATH=\u0026#34;$(pwd)/venv\u0026#34; $ python3 -m venv ${SAT_VENV_PATH} $ . ${SAT_VENV_PATH}/bin/activate Clone the SAT source code.\nNote: To use SAT version 3.19, this example clones the release/3.19 branch of Cray-HPE/sat. However, for better clarity, these instructions include steps that apply only to versions newer than 3.19. Specifically, the instructions include references to the csm-api-client package, which was not a dependency of SAT in version 3.19.\n(venv) $ git clone --branch=release/3.19 https://github.com/Cray-HPE/sat.git Set up the SAT CSM Python dependencies to be installed from their source code.\nSAT CSM Python dependency packages are not currently distributed publicly as source packages or binary distributions. They must be installed from their source code hosted on GitHub. Also, to install the cray-product-catalog Python package, you must first clone it locally. Use the following steps to modify the SAT CSM Python dependencies so they can be installed from their source code.\nClone the source code for cray-product-catalog.\n(venv) $ git clone --branch v1.6.0 https://github.com/Cray-HPE/cray-product-catalog In the cray-product-catalog directory, create a file named .version that contains the version of cray-product-catalog.\n(venv) $ echo 1.6.0 \u0026gt; cray-product-catalog/.version Open the \u0026ldquo;locked\u0026rdquo; requirements file in a text editor.\n(venv) $ vim sat/requirements.lock.txt Update the line containing cray-product-catalog so that it reflects the local path to cray-product-catalog.\nIt should read as follows:\n./cray-product-catalog For versions of SAT newer than 3.19, change the line containing csm-api-client to read as follows:\ncsm-api-client@git+https://github.com/Cray-HPE/python-csm-api-client@release/1.1 (Optional) Confirm that requirements.lock.txt is modified as expected.\nNote: For versions newer than 3.19, you will see both cray-product-catalog and csm-api-client. For version 3.19 and older, you will only see cray-product-catalog.\n(venv) $ grep -E \u0026#39;cray-product-catalog|csm-api-client\u0026#39; sat/requirements.lock.txt ./cray-product-catalog csm-api-client@git+https://github.com/Cray-HPE/python-csm-api-client@release/1.1 Install the modified SAT dependencies.\n(venv) $ pip install -r sat/requirements.lock.txt ... Install the SAT Python package.\n(venv) $ pip install ./sat ... Optional: Add the sat virtual environment to the user\u0026rsquo;s PATH environment variable.\nIf a shell other than bash is in use, replace ~/.bash_profile with the appropriate profile path.\nIf the virtual environment is not added to the user\u0026rsquo;s PATH environment variable, then source ${SAT_VENV_PATH}/bin/activate will need to be run before running any SAT commands.\n(venv) $ deactivate $ echo export PATH=\\\u0026#34;${SAT_VENV_PATH}/bin:${PATH}\\\u0026#34; \u0026gt;\u0026gt; ~/.bash_profile $ source ~/.bash_profile Copy the file /etc/kubernetes/admin.conf from ncn-m001 to ~/.kube/config on the external system.\nNote that this file contains credentials to authenticate against the Kubernetes API as the administrative user, so it should be treated as sensitive.\n$ mkdir -p ~/.kube $ scp ncn-m001:/etc/kubernetes/admin.conf ~/.kube/config admin.conf 100% 5566 3.0MB/s 00:00 Add a new entry for the hostname kubernetes to the external system\u0026rsquo;s /etc/hosts file.\nThe kubernetes hostname should correspond to the CAN IP address on ncn-m001. On CSM 1.2, this can be determined by querying the IP address of the bond0.cmn0 interface.\n$ ssh ncn-m001 ip addr show bond0.cmn0 13: bond0.cmn0@bond0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether b8:59:9f:1d:d9:0e brd ff:ff:ff:ff:ff:ff inet 10.102.1.11/24 brd 10.102.1.255 scope global vlan007 valid_lft forever preferred_lft forever inet6 fe80::ba59:9fff:fe1d:d90e/64 scope link valid_lft forever preferred_lft forever $ IP_ADDRESS=10.102.1.11 On CSM versions prior to 1.2, the CAN IP can be determined by querying the IP address of the vlan007 interface.\n$ ssh ncn-m001 ip addr show vlan007 13: vlan007@bond0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether b8:59:9f:1d:d9:0e brd ff:ff:ff:ff:ff:ff inet 10.102.1.10/24 brd 10.102.1.255 scope global vlan007 valid_lft forever preferred_lft forever inet6 fe80::ba59:9fff:fe1d:d90e/64 scope link valid_lft forever preferred_lft forever $ IP_ADDRESS=10.102.1.10 Once the IP address is determined, add an entry to /etc/hosts mapping the IP address to the hostname kubernetes.\n$ echo \u0026#34;${IP_ADDRESS} kubernetes\u0026#34; | sudo tee -a /etc/hosts 10.102.1.11 kubernetes Modify ~/.kube/config to set the cluster server address.\nThe value of the server key for the kubernetes cluster under the clusters section should be set to https://kubernetes:6443.\n--- clusters: - cluster: certificate-authority-data: REDACTED server: https://kubernetes:6443 name: kubernetes ... Confirm that kubectl can access the CSM Kubernetes cluster.\n$ kubectl get nodes NAME STATUS ROLES AGE VERSION ncn-m001 Ready master 135d v1.19.9 ncn-m002 Ready master 136d v1.19.9 ncn-m003 Ready master 136d v1.19.9 ncn-w001 Ready \u0026lt;none\u0026gt; 136d v1.19.9 ncn-w002 Ready \u0026lt;none\u0026gt; 136d v1.19.9 ncn-w003 Ready \u0026lt;none\u0026gt; 136d v1.19.9 Use sat init to create a configuration file for SAT.\n$ sat init INFO: Configuration file \u0026#34;/home/user/.config/sat/sat.toml\u0026#34; generated. Copy the platform CA certificates from the management NCN and configure the certificates for use with SAT.\nIf a shell other than bash is in use, replace ~/.bash_profile with the appropriate profile path.\n$ scp ncn-m001:/etc/pki/trust/anchors/platform-ca-certs.crt . $ echo export REQUESTS_CA_BUNDLE=\\\u0026#34;$(realpath platform-ca-certs.crt)\\\u0026#34; \u0026gt;\u0026gt; ~/.bash_profile $ source ~/.bash_profile Edit the SAT configuration file to set the API and S3 hostnames.\nExternally available API endpoints are given domain names in PowerDNS, so the endpoints in the configuration file should each be set to subdomain.system-name.site-domain, where system-name and site-domain are replaced with the values specified during csi config init, and subdomain is the DNS name for the externally available service. For more information, refer to Externally Exposed Services in the Cray System Management Documentation.\nThe API gateway has the subdomain api, and S3 has the subdomain s3. The S3 endpoint runs on port 8080. The following options should be set in the SAT configuration file:\n[api_gateway] host = \u0026#34;api.system-name.site-domain\u0026#34; [s3] endpoint = \u0026#34;http://s3.system-name.site-domain:8080\u0026#34; Edit the SAT configuration file to specify the Keycloak user which will be accessing the REST API.\n[api_gateway] username = \u0026#34;user\u0026#34; Authenticate against the API gateway with sat auth.\nFor more information, see SAT Authentication.\nGenerate S3 credentials.\nFor more information, see Generate SAT S3 Credentials.\n"
},
{
	"uri": "/docs-sat/en-24/usage/",
	"title": "SAT Usage",
	"tags": [],
	"description": "",
	"content": "SAT Usage SAT Bootprep Change the BOS Version "
},
{
	"uri": "/docs-sat/en-24/",
	"title": "HPE Cray EX System Admin Toolkit (SAT) Guide",
	"tags": [],
	"description": "",
	"content": "HPE Cray EX System Admin Toolkit (SAT) Guide Introduction to SAT About System Admin Toolkit (SAT) System Admin Toolkit Command Overview Command Prompt Conventions in SAT SAT in CSM SAT Dependencies SAT Installation Install the System Admin Toolkit Product Stream Configure SAT SAT Authentication Generate SAT S3 Credentials Set System Revision Information Perform NCN Personalization SAT Post-Upgrade Remove Obsolete Configuration File Sections SAT Logging Set System Revision Information SAT Uninstall and Downgrade Uninstall: Removing a Version of SAT Activate: Switching Between Versions Optional: Installing and Configuring SAT on an External System SAT Upgrade with CNE Installer Upgrade the System Admin Toolkit Product Stream Post-Upgrade Cleanup Procedure Remove Obsolete Configuration File Sections SAT Logging SAT Dashboards SAT Kibana Dashboards SAT Grafana Dashboards SAT Usage SAT Bootprep Change the BOS Version SAT Release Notes Summary of Changes in SAT 2.4 Summary of Changes in SAT 2.3 Summary of Changes in SAT 2.2 Summary of SAT Changes in Shasta v1.5 Summary of SAT Changes in Shasta v1.4.1 Summary of SAT Changes in Shasta v1.4 Summary of SAT Changes in Shasta v1.3.2 Summary of SAT Changes in Shasta v1.3 "
},
{
	"uri": "/docs-sat/en-24/usage/change_bos_version/",
	"title": "Change the BOS Version",
	"tags": [],
	"description": "",
	"content": "Change the BOS Version By default, SAT uses Boot Orchestration Service (BOS) version one. You can select the BOS version to use for individual commands with the --bos-version option. For more information on this option, refer to the man page for a specific command.\nYou can also configure the BOS version to use in the SAT config file. Do this under the api_version setting in the bos section of the config file. If the system is using an existing SAT config file from an older version of SAT, the bos section might not exist. In that case, add the bos section with the BOS version desired in the api_version setting.\nFind the SAT config file at ~/.config/sat/sat.toml, and look for a section like this:\n[bos] api_version = \u0026#34;v1\u0026#34; In this example, SAT is using BOS version \u0026quot;v1\u0026quot;.\nChange the line specifying the api_version to the BOS version desired (for example, \u0026quot;v2\u0026quot;).\n[bos] api_version = \u0026#34;v2\u0026#34; If applicable, uncomment the api_version line.\nIf the system is using an existing SAT config file from a recent version of SAT, the api_version line might be commented out like this:\n[bos] # api_version = \u0026#34;v2\u0026#34; If the line is commented out, SAT will still use the default BOS version. To ensure a different BOS version is used, uncomment the api_version line by removing # at the beginning of the line.\n"
},
{
	"uri": "/docs-sat/en-24/introduction/",
	"title": "Introduction to SAT",
	"tags": [],
	"description": "",
	"content": "Introduction to SAT About System Admin Toolkit (SAT) The System Admin Toolkit (SAT) is designed to assist administrators with common tasks, such as troubleshooting and querying information about the HPE Cray EX System and its components, system boot and shutdown, and replacing hardware components.\nSAT offers a command line utility which uses subcommands. There are similarities between SAT commands and xt commands used on the Cray XC platform. For more information on SAT commands, see System Admin Toolkit Command Overview.\nSix Kibana Dashboards are included with SAT. They provide organized output for system health information.\nAER Kibana Dashboard ATOM Kibana Dashboard Heartbeat Kibana Dashboard Kernel Kibana Dashboard MCE Kibana Dashboard RAS Daemon Kibana Dashboard Four Grafana Dashboards are included with SAT. They display messages that are generated by the HSN (High Speed Network) and are reported through Redfish.\nGrafana Fabric Congestion Dashboard Grafana Fabric Errors Dashboard Grafana Fabric Port State Dashboard Grafana Fabric RFC3635 Dashboard In CSM 1.3 and newer, the sat command is automatically available on all the Kubernetes NCNs. For more information, see SAT in CSM. Older versions of CSM do not have the sat command automatically available, and SAT must be installed as a separate product.\nSystem Admin Toolkit Command Overview Describes the SAT Command Line Utility, lists the key commands found in the System Admin Toolkit man pages, and provides instruction on the SAT Container Environment.\nSAT Command Line Utility The primary component of the System Admin Toolkit (SAT) is a command-line utility run from Kubernetes manager nodes (ncn-m nodes).\nIt is designed to assist administrators with common tasks, such as troubleshooting and querying information about the HPE Cray EX System and its components, system boot and shutdown, and replacing hardware components. There are similarities between SAT commands and xt commands used on the Cray XC platform.\nSAT Commands The top-level SAT man page describes the toolkit, documents the global options affecting all subcommands, documents configuration file options, and references the man page for each subcommand. SAT consists of many subcommands that each have their own set of options.\nSAT Container Environment The sat command-line utility runs in a container using Podman, a daemonless container runtime. SAT runs on Kubernetes manager nodes. A few important points about the SAT container environment include the following:\nUsing either sat or sat bash always launches a container. The SAT container does not have access to the NCN file system. There are two ways to run sat.\nInteractive: Launching a container using sat bash, followed by a sat command. Non-interactive: Running a sat command directly on a Kubernetes manager node. In both of these cases, a container is launched in the background to execute the command. The first option, running sat bash first, gives an interactive shell, at which point sat commands can be run. In the second option, the container is launched, executes the command, and upon the command\u0026rsquo;s completion the container exits. The following two examples show the same action, checking the system status, using interactive and non-interactive modes.\nInteractive ncn-m001# sat bash (CONTAINER-ID)sat-container# sat status Non-interactive ncn-m001# sat status Interactive Advantages Running sat using the interactive command prompt gives the ability to read and write local files on ephemeral container storage. If multiple sat commands are being run in succession, then use sat bash to launch the container beforehand. This will save time because the container does not need to be launched for each sat command.\nNon-interactive Advantages The non-interactive mode is useful if calling sat with a script, or when running a single sat command as a part of several steps that need to be executed from a management NCN.\nMan Pages - Interactive and Non-interactive Modes To view a sat man page from a Kubernetes manager node, use sat-man on the manager node as shown in the following example.\nncn-m001# sat-man status A man page describing the SAT container environment is available on the Kubernetes manager nodes, which can be viewed either with man sat or man sat-podman from the manager node.\nncn-m001# man sat ncn-m001# man sat-podman Command Prompt Conventions in SAT The host name in a command prompt indicates where the command must be run. The account that must run the command is also indicated in the prompt.\nThe root or super-user account always has the # character at the end of the prompt and has the host name of the host in the prompt. Any non-root account is indicated with account@hostname\u0026gt;. A user account that is neither root nor crayadm is referred to as user. The command prompt inside the SAT container environment is indicated with the string as follows. It also has the \u0026ldquo;#\u0026rdquo; character at the end of the prompt. Command Prompt Meaning ncn-m001# Run on one of the Kubernetes Manager servers. (Non-interactive) (CONTAINER_ID) sat-container# Run the command inside the SAT container environment by first running sat bash. (Interactive) Examples of the sat status command used by an administrator:\nncn-m001# sat status ncn-m001# sat bash (CONTAINER_ID) sat-container# sat status SAT in CSM In CSM 1.3 and newer, the sat command is automatically available on all the Kubernetes NCNs, but it is still possible to install SAT as a separate product stream. Any version of SAT installed as a separate product stream overrides the sat command available in CSM. Installing the SAT product stream allows additional supporting components to be added:\nAn entry for SAT in the cray-product-catalog Kubernetes ConfigMap is only created by installing the SAT product stream. Otherwise, there will be no entry for this version of SAT in the output of sat showrev.\nThe sat-install-utility container image is only available with the full SAT product stream. This container image provides uninstall and activate functionality when used with the prodmgr command. (In SAT 2.3 and older, SAT was only available to install as a separate product stream. Because these versions were packaged with sat-install-utility, it is still possible to uninstall these versions of SAT.)\nThe docs-sat RPM package is only available with the full SAT product stream.\nThe sat-config-management git repository in Gitea (VCS) and thus the SAT layer of NCN CFS configuration is only available with the full SAT product stream.\nIf the SAT product stream is not installed, there will be no configuration content for SAT in VCS. Therefore, CFS configurations that apply to NCNs (for example, ncn-personalization) should not include a SAT layer.\nThe SAT configuration layer modifies the permissions of files left over from prior installations of SAT, so that the Keycloak username that authenticates to the API gateway cannot be read by users other than root. Specifically, it it does the following:\nModifies the sat.toml configuration file which contains the username so that it is only readable by root.\nModifies the /root/.config/sat/tokens directory so that the directory is only readable by root. This is needed because the names of the files within the tokens directory contain the username.\nRegardless of the SAT configuration being applied, passwords and the contents of the tokens are never readable by other users. These permission changes only apply to files created by previous installations of SAT. In the current version of SAT all files and directories are created with the appropriate permissions.\nSAT Dependencies Most sat subcommands depend on services or components from other products in the HPE Cray EX (Shasta) software stack. The following list shows these dependencies for each subcommand. Each service or component is listed under the product it belongs to.\nsat auth CSM Keycloak sat bmccreds CSM System Configuration Service (SCSD) sat bootprep CSM Boot Orchestration Service (BOS) Configuration Framework Service (CFS) Image Management Service (IMS) Version Control Service (VCS) Kubernetes S3 sat bootsys CSM Boot Orchestration Service (BOS) Cray Advanced Platform Monitoring and Control (CAPMC) Ceph Compute Rolling Upgrade Service (CRUS) Etcd Firmware Action Service (FAS) Hardware State Manager (HSM) Kubernetes S3 COS Node Memory Dump (NMD) sat diag CSM Hardware State Manager (HSM) CSM-Diags Fox sat firmware CSM Firmware Action Service (FAS) sat hwhist CSM Hardware State Manager (HSM) sat hwinv CSM Hardware State Manager (HSM) sat hwmatch CSM Hardware State Manager (HSM) sat init None\nsat k8s CSM Kubernetes sat nid2xname CSM Hardware State Manager (HSM) sat sensors CSM Hardware State Manager (HSM) HM Collector SMA Telemetry API sat setrev CSM S3 sat showrev CSM Hardware State Manager (HSM) Kubernetes S3 sat slscheck CSM Hardware State Manager (HSM) Kubernetes S3 sat status CSM Hardware State Manager (HSM) sat swap Slingshot Fabric Manager sat switch Deprecated: See sat swap\nsat xname2nid CSM Hardware State Manager (HSM) "
},
{
	"uri": "/docs-sat/en-24/dashboards/sat_grafana_dashboards/",
	"title": "SAT Grafana Dashboards",
	"tags": [],
	"description": "",
	"content": "SAT Grafana Dashboards The SAT Grafana Dashboards display messages that are generated by the HSN (High Speed Network) and reported through Redfish. The messages are displayed based on severity.\nGrafana can be accessed via web browser at the following URL:\nhttps://sma-grafana.cmn.\u0026lt;site-domain\u0026gt; The value of site-domain can be obtained as follows:\nncn-m001:~ # kubectl get secret site-init -n loftsman -o jsonpath=\u0026#39;{.data.customizations\\.yaml}\u0026#39; | \\ base64 -d | grep \u0026#34;external:\u0026#34; That command will produce the following output, for example:\nexternal: EXAMPLE_DOMAIN.com This would result in the address for Grafana being https://sma-grafana.cmn.EXAMPLE_DOMAIN.com\nFor more information on accessing the Grafana Dashboards, refer to Access the Grafana Monitoring UI in the SMA product documentation.\nFor more information on the interpretation of metrics for the SAT Grafana Dashboards, refer to \u0026ldquo;Fabric Telemetry Kafka Topics\u0026rdquo; in the SMA product documentation.\nNavigate SAT Grafana Dashboards There are four Fabric Telemetry dashboards used in SAT that report on the HSN. Two contain chart panels and two display telemetry in a tabular format.\nDashboard Name Display Type Fabric Congestion Chart Panels Fabric RFC3635 Chart Panels Fabric Errors Tabular Format Fabric Port State Tabular Format The tabular format presents a single point of telemetry for a given location and metric, either because the telemetry is not numerical or that it changes infrequently. The value shown is the most recently reported value for that location during the time range selected, if any. The interval setting is not used for tabular dashboards.\nSAT Grafana Interval and Locations Options Shows the Interval and Locations Options for the available telemetry.\nThe value of the Interval option sets the time resolution of the received telemetry. This works a bit like a histogram, with the available telemetry in an interval of time going into a \u0026ldquo;bucket\u0026rdquo; and averaging out to a single point on the chart or table. The special value auto will choose an interval based on the time range selected.\nFor more information, refer to Grafana Templates and Variables.\nThe Locations option allows restriction of the telemetry shown by locations, either individual links or all links in a switch. The selection presented updates dynamically according to time range, except for the errors dashboard, which always has entries for all links and switches, although the errors shown are restricted to the selected time range.\nThe chart panels for the RFC3635 and Congestion dashboards allow selection of a single location from the chart\u0026rsquo;s legend or the trace on the chart.\nGrafana Fabric Congestion Dashboard SAT Grafana Dashboards provide system administrators a way to view fabric telemetry data across all Rosetta switches in the system and assess the past and present health of the high-speed network. It also allows the ability to drill down to view data for specific ports on specific switches.\nThis dashboard contains the variable, Port Type not found in the other dashboards. The possible values are edge, local, and global and correspond to the link\u0026rsquo;s relationship to the network topology. The locations presented in the panels are restricted to the values (any combination, defaults to \u0026ldquo;all\u0026rdquo;) selected.\nThe metric values for links of a given port type are similar in value to each other but very distinct from the values of other types. If the values for different port types are all plotted together, the values for links with lower values are indistinguishable from zero when plotted.\nThe port type of a link is reported as a port state \u0026ldquo;subtype\u0026rdquo; event when defined at port initialization.\nGrafana Fabric Errors Dashboard This dashboard reports error counters in a tabular format in three panels.\nThere is no Interval option because this parameter is not used to set a coarseness of the data. Only a single value is presented that displays the most recent value in the time range.\nUnlike other dashboards, the locations presented are all locations in the system rather than having telemetry within the time range selected. However, the values are taken from telemetry within the time range.\nGrafana Fabric Port State Dashboard There is no Interval option because this parameter is not used to set a coarseness of the data. Only a single value is presented that displays the most recent value in the time range.\nThe Fabric Port State telemetry is distinct because it typically is not numeric. It also updates infrequently, so a long time range may be necessary to obtain any values. Port State is refreshed daily, so a time range of 24 hours results in all states for all links in the system being shown.\nThe three columns named, group, switch, and port are not port state events, but extra information included with all port state events.\nGrafana Fabric RFC3635 Dashboard For more information on performance counters, refer to Definitions of Managed Objects for the Ethernet-like Interface Types, an Internet standards document.\nBecause these metrics are counters that only increase over time, the values plotted are the change in the counter\u0026rsquo;s value over the interval setting.\n"
},
{
	"uri": "/docs-sat/en-24/cne_install/",
	"title": "SAT Upgrade with CNE Installer",
	"tags": [],
	"description": "",
	"content": "SAT Upgrade with CNE Installer Upgrade the System Admin Toolkit Product Stream Describes how to upgrade the System Admin Toolkit (SAT) product stream by using the Compute Node Environment (CNE) installer (cne-install). The CNE installer can be used only for upgrades and not for fresh installations. For installation instructions, see Install the System Admin Toolkit Product Stream.\nUpgrading SAT with cne-install is recommended because the process is both automated and logged to help you save time. The CNE installer can be used to upgrade SAT alone or with other supported products. For more information on cne-install and its options, refer to the HPE Cray EX System Software Getting Started Guide (S-8000).\nPrerequisites CSM is installed and verified. There must be at least 2 gigabytes of free space on the manager NCN on which the procedure is run. Notes on the Procedures Ellipses (...) in shell output indicate omitted lines. In the examples below, replace x.y.z with the version of the SAT product stream being upgraded. \u0026lsquo;manager\u0026rsquo; and \u0026lsquo;master\u0026rsquo; are used interchangeably in the steps below. Pre-Upgrade Procedure Start a typescript and set the shell prompt.\nThe typescript will record the commands and the output from this upgrade. The prompt is set to include the date and time.\nncn-m001# script -af product-sat.$(date +%Y-%m-%d).txt ncn-m001# export PS1=\u0026#39;\\u@\\H \\D{%Y-%m-%d} \\t \\w # \u0026#39; Upgrade Procedure Copy the release distribution gzipped tar file to ncn-m001.\nThe cne-install command installs all files in the media directory by default. If you are upgrading SAT alone, ensure only the SAT tarball is in the media directory.\nRun the CNE installer.\nIf you are upgrading SAT along with other supported products, run the following command.\nncn-m001# cne-install -m MEDIA_DIR install -B WORKING_BRANCH -bpc BOOTPREP_CONFIG_CN \\ -bpn BOOTPREP_CONFIG_NCN The cne-install command will use the provided BOOTPREP_CONFIG_CN and BOOTPREP_CONFIG_NCN files for the run.\nIf you are upgrading SAT alone, run the following commands.\nncn-m001# cne-install -m MEDIA_DIR install -B \u0026#39;{{product_type}}-{{version_x_y_z}}\u0026#39; \\ -bpn BOOTPREP_CONFIG_NCN -e update_working_branches ncn-m001# cne-install -m MEDIA_DIR install -B \u0026#39;{{product_type}}-{{version_x_y_z}}\u0026#39; \\ -bpn BOOTPREP_CONFIG_NCN -b sat_bootprep_ncn -e ncn_personalization Optional: Stop the typescript.\nNOTE: This step can be skipped if you wish to use the same typescript for the remainder of the SAT upgrade (see Next Steps).\nncn-m001# exit SAT version x.y.z is now upgraded, meaning the SAT x.y.z release has been loaded into the system software repository.\nSAT configuration content for this release has been uploaded to VCS. SAT content for this release has been uploaded to the CSM product catalog. SAT content for this release has been uploaded to Nexus repositories. The sat command is available. Next Steps At this point, the release distribution files can be removed from the system as described in Post-Upgrade Cleanup Procedure.\nIf other HPE Cray EX software products are being upgraded in conjunction with SAT, refer to the HPE Cray EX System Software Getting Started Guide (S-8000) to determine which step to execute next.\nIf no other HPE Cray EX software products are being upgraded at this time, execute the SAT Post-Upgrade procedures:\nRemove obsolete configuration file sections SAT Logging Post-Upgrade Cleanup Procedure Optional: Remove the SAT release distribution tar file and extracted directory.\nncn-m001# rm sat-x.y.z.tar.gz ncn-m001# rm -rf sat-x.y.z/ Remove Obsolete Configuration File Sections Prerequisites The Upgrade the System Admin Toolkit Product Stream procedure has been successfully completed. Procedure After upgrading SAT, if using the configuration file from a previous version, there may be configuration file sections no longer used in the new version. For example, when upgrading from Shasta 1.4 to Shasta 1.5, the [redfish] configuration file section is no longer used. In that case, the following warning may appear upon running sat commands.\nWARNING: Ignoring unknown section \u0026#39;redfish\u0026#39; in config file. Remove the [redfish] section from /root/.config/sat/sat.toml to resolve the warning.\n[redfish] username = \u0026#34;admin\u0026#34; password = \u0026#34;adminpass\u0026#34; Repeat this process for any configuration file sections for which there are \u0026ldquo;unknown section\u0026rdquo; warnings.\nSAT Logging As of SAT version 2.2, some command output that was previously printed to stdout is now logged to stderr. These messages are logged at the INFO level. The default logging threshold was changed from WARNING to INFO to accommodate this logging change. Additionally, some messages previously logged at the INFO are now logged at the DEBUG level.\nThese changes take effect automatically. However, if the default output threshold has been manually set in ~/.config/sat/sat.toml, it should be changed to ensure that important output is shown in the terminal.\nUpdate Configuration In the following example, the stderr log level, logging.stderr_level, is set to WARNING, which will exclude INFO-level logging from terminal output.\nncn-m001:~ # grep -A 3 logging ~/.config/sat/sat.toml [logging] ... stderr_level = \u0026#34;WARNING\u0026#34; To enable the new default behavior, comment this line out, delete it, or set the value to \u0026ldquo;INFO\u0026rdquo;.\nIf logging.stderr_level is commented out, its value will not affect logging behavior. However, it may be helpful set its value to INFO as a reminder of the new default behavior.\nAffected Commands The following commands trigger messages that have been changed from stdout print calls to INFO-level (or WARNING- or ERROR-level) log messages:\nsat bootsys --stage shutdown --stage session-checks sat sensors The following commands trigger messages that have been changed from INFO-level log messages to DEBUG-level log messages:\nsat nid2xname sat xname2nid sat swap "
},
{
	"uri": "/docs-sat/en-24/usage/sat_bootprep/",
	"title": "SAT Bootprep",
	"tags": [],
	"description": "",
	"content": "SAT Bootprep SAT provides an automated solution for creating CFS configurations, building and configuring images in IMS, and creating BOS session templates based on a given input file which defines how those configurations, images, and session templates should be created.\nThis automated process centers around the sat bootprep command. Man page documentation for sat bootprep can be viewed similarly to other SAT commands.\nncn-m001# sat-man sat-bootprep SAT Bootprep vs SAT Bootsys sat bootprep is used to create CFS configurations, build and rename IMS images, and create BOS session templates which tie the configurations and images together during a BOS session.\nsat bootsys automates several portions of the boot and shutdown processes, including (but not limited to) performing BOS operations (such as creating BOS sessions), powering on and off cabinets, and checking the state of the system prior to shutdown.\nEditing a Bootprep Input File The input file provided to sat bootprep is a YAML-formatted file containing information which CFS, IMS, and BOS use to create configurations, images, and BOS session templates respectively. Writing and modifying these input files is the main task associated with using sat bootprep. An input file is composed of three main sections, one each for configurations, images, and session templates. These sections may be specified in any order, and any of the sections may be omitted if desired.\nProviding a Schema Version The sat bootprep input file is validated against a versioned schema definition. The input file should specify the version of the schema with which it is compatible under a schema_version key. For example:\n--- schema_version: 1.0.2 The current sat bootprep input file schema version can be viewed with the following command:\nncn-m001# sat bootprep view-schema | grep \u0026#39;^version:\u0026#39; version: \u0026#39;1.0.2\u0026#39; The sat bootprep run command validates the schema version specified in the input file. The command also makes sure that the schema version of the input file is compatible with the schema version understood by the current version of sat bootprep. For more information on schema version validation, refer to the schema_version property description in the bootprep input file schema. For more information on viewing the bootprep input file schema in either raw form or user-friendly HTML form, see Viewing the Exact Schema Specification or Generating User-Friendly Documentation.\nThe default sat bootprep input files provided by the hpc-csm-software-recipe release distribution already contain the correct schema version.\nDefining CFS Configurations The CFS configurations are defined under a configurations key. Under this key, you can list one or more configurations to create. For each configuration, give a name in addition to the list of layers that comprise the configuration.\nEach layer can be defined by a product name and optionally a version number, commit hash, or branch in the product\u0026rsquo;s configuration repository. If this method is used, the layer is created in CFS by looking up relevant configuration information (including the configuration repository and commit information) from the cray-product-catalog Kubernetes ConfigMap as necessary. A version may be supplied. However, if it is absent, the version is assumed to be the latest version found in the cray-product-catalog.\nAlternatively, a configuration layer can be defined by explicitly referencing the desired configuration repository. You must then specify the intended version of the Ansible playbooks by providing a branch name or commit hash with branch or commit.\nThe following example shows a CFS configuration with two layers. The first layer is defined in terms of a product name and version, and the second layer is defined in terms of a Git clone URL and branch:\n--- configurations: - name: example-configuration layers: - name: example-product playbook: example.yml product: name: example version: 1.2.3 - name: another-example-product playbook: another-example.yml git: url: \u0026#34;https://vcs.local/vcs/another-example-config-management.git\u0026#34; branch: main When sat bootprep is run against an input file, a CFS configuration is created corresponding to each configuration in the configurations section. For example, the configuration created from an input file with the layers listed above might look something like the following:\n{ \u0026#34;lastUpdated\u0026#34;: \u0026#34;2022-02-07T21:47:49Z\u0026#34;, \u0026#34;layers\u0026#34;: [ { \u0026#34;cloneUrl\u0026#34;: \u0026#34;https://vcs.local/vcs/example-config-management.git\u0026#34;, \u0026#34;commit\u0026#34;: \u0026#34;\u0026lt;commit hash\u0026gt;\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;example product\u0026#34;, \u0026#34;playbook\u0026#34;: \u0026#34;example.yml\u0026#34; }, { \u0026#34;cloneUrl\u0026#34;: \u0026#34;https://vcs.local/vcs/another-example-config-management.git\u0026#34;, \u0026#34;commit\u0026#34;: \u0026#34;\u0026lt;commit hash\u0026gt;\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;another example product\u0026#34;, \u0026#34;playbook\u0026#34;: \u0026#34;another-example.yml\u0026#34; } ], \u0026#34;name\u0026#34;: \u0026#34;example-configuration\u0026#34; } Defining IMS Images The IMS images are defined under an images key. Under the images key, the user may define one or more images to be created in a list. Each element of the list defines a separate IMS image to be built and/or configured. Images must contain a name key and a base key.\nThe name key defines the name of the resulting IMS image. The base key defines the base image to be configured or the base recipe to be built and optionally configured. One of the following keys must be present under the base key:\nUse an ims key to specify an existing image or recipe in IMS. Use a product key to specify an image or recipe provided by a particular version of a product. Note that this is only possible if the product provides a single image or recipe. Use an image_ref key to specify another image from the input file using its ref_name. Images may also contain the following keys:\nUse a configuration key to specify a CFS configuration with which to customize the built image. If a configuration is specified, then configuration groups must also be specified using the configuration_group_names key. Use a ref_name key to specify a unique name that can refer to this image within the input file in other images or in session templates. The ref_name key allows references to images from the input file that have dynamically generated names as described in Dynamic Variable Substitutions. Use a description key to describe the image in the bootprep input file. Note that this key is not currently used. Here is an example of an image using an existing IMS recipe as its base. This example builds an IMS image from that recipe. It then configures it with a CFS configuration named example-compute-config. The example-compute-config CFS configuration can be defined under the configurations key in the same input file, or it can be an existing CFS configuration. Running sat bootprep against this input file results in an image named example-compute-image.\nimages: - name: example-compute-image description: \u0026gt; An example compute node image built from an existing IMS recipe. base: ims: name: example-compute-image-recipe type: recipe configuration: example-compute-config configuration_group_names: - Compute Here is an example showing the definition of two images. The first image is built from a recipe provided by the cos product. The second image uses the first image as a base and configures it with a configuration named example-compute-config. The value of the first image\u0026rsquo;s ref_name key is used in the second image\u0026rsquo;s base.image_ref key to specify it as a dependency. Running sat bootprep against this input file results in two images, the first named example-cos-image and the second named example-compute-image.\nimages: - name: example-cos-image ref_name: example-cos-image description: \u0026gt; An example image built from a recipe provided by the COS product. base: product: name: cos version: 2.3.101 type: recipe - name: example-compute-image description: \u0026gt; An example image built from a recipe provided by the COS product. base: image_ref: example-cos-image configuration: example-compute-config configuration_group_names: - Compute Defining BOS Session Templates The BOS session templates are defined under the session_templates key. Each session template must provide values for the name, image, configuration, and bos_parameters keys. The name key defines the name of the resulting BOS session template. The image key defines the image to use in the BOS session template. One of the following keys must be present under the image key:\nUse an ims key to specify an existing image or recipe in IMS. Use an image_ref key to specify another image from the input file using its ref_name. The configuration key defines the CFS configuration specified in the BOS session template.\nThe bos_parameters key defines parameters that are passed through directly to the BOS session template. The bos_parameters key should contain a boot_sets key, and each boot set in the session template should be specified under boot_sets. Each boot set can contain the following keys, all of which are optional:\nUse a kernel_parameters key to specify the parameters passed to the kernel on the command line. Use a network key to specify the network over which the nodes boot. Use a node_list key to specify the nodes to add to the boot set. Use a node_roles_groups key to specify the HSM roles to add to the boot set. Use a node_groups key to specify the HSM groups to add to the boot set. Use a rootfs_provider key to specify the root file system provider. Use a rootfs_provider_passthrough key to specify the parameters to add to the rootfs= kernel parameter. As mentioned above, the parameters under bos_parameters are passed through directly to BOS. For more information on the properties of a BOS boot set, refer to BOS Session Templates in the Cray System Management Documentation.\nHere is an example of a BOS session template that refers to an existing IMS image by name:\nsession_templates: - name: example-session-template image: ims: name: example-image configuration: example-configuration bos_parameters: boot_sets: example_boot_set: kernel_parameters: ip=dhcp quiet node_roles_groups: - Compute rootfs_provider: cpss3 rootfs_provider_passthrough: dvs:api-gw-service-nmn.local:300:nmn0 Here is an example of a BOS session template that refers to an image from the input file by its ref_name. This requires that an image defined in the input file specifies example-image as the value of its ref_name key.\nsession_templates: - name: example-session-template image: image_ref: example-image configuration: example-configuration bos_parameters: boot_sets: example_boot_set: kernel_parameters: ip=dhcp quiet node_roles_groups: - Compute rootfs_provider: cpss3 rootfs_provider_passthrough: dvs:api-gw-service-nmn.local:300:nmn0 HPC CSM Software Recipe Variable Substitutions The HPC CSM Software Recipe provides a manifest defining the versions of each HPC software product included in the recipe. These product versions can be used in the sat bootprep input file with Jinja2 template syntax.\nSelecting an HPC CSM Software Recipe Version By default, the sat bootprep command uses the product versions from the latest installed version of the HPC CSM Software Recipe. However, you can override this with the --recipe-version command line argument to sat bootprep run.\nFor example, to explicitly select the 22.11.0 version of the HPC CSM Software Recipe, specify --recipe-version 22.11.0:\nncn-m001# sat bootprep run --recipe-version 22.11.0 compute-and-uan-bootprep.yaml Values Supporting Jinja2 Template Rendering The entire sat bootprep input file is not rendered by the Jinja2 template engine. Jinja2 template rendering of the input file is performed individually for each supported value. The values of the following keys support rendering as a Jinja2 template:\nThe name key of each configuration under the configurations key. The following keys of each layer under the layers key in a configuration: name git.branch product.version product.branch The following keys of each image under the images key: name base.product.version configuration The following keys of each session template under the session_templates key: name configuration You can use Jinja2 built-in filters in values of any of the keys listed above. In addition, Python string methods can be called on the string variables.\nViewing HPC CSM Software Recipe Variables HPC CSM Software Recipe variables are available, and you can use them in the values of the keys listed above. View these variables by cloning the hpc-csm-software-recipe repository from VCS and accessing the product_vars.yaml file on the branch that corresponds to the targeted version of the HPC CSM Software Recipe.\nSet up a shell script to access the password for the crayvcs user:\nncn-m001# cat \u0026gt; vcs-creds-helper.sh \u0026lt;\u0026lt;EOF #!/bin/bash kubectl get secret -n services vcs-user-credentials -o jsonpath={.data.vcs_password} | base64 -d EOF Ensure vcs-creds-helper.sh is executable:\nncn-m001# chmod u+x vcs-creds-helper.sh Set the GIT_ASKPASS environment variable to the path to the vcs-creds-helper.sh script:\nncn-m001# export GIT_ASKPASS=\u0026#34;$PWD/vcs-creds-helper.sh\u0026#34; Clone the hpc-csm-software-recipe repository:\nncn-m001# git clone https://crayvcs@api-gw-service-nmn.local/vcs/cray/hpc-csm-software-recipe.git Change the directory to the hpc-csm-software-recipe repository:\nncn-m001# cd hpc-csm-software-recipe View the versions of the HPC CSM Software Recipe on the system:\nncn-m001# git branch -r Check out the branch of the hpc-csm-software-recipe repository that corresponds to the targeted HPC CSM Software Recipe version. For example, for recipe version 22.11.0:\nncn-m001# git checkout cray/hpc-csm-software-recipe/22.11.0 View the contents of the file product_vars.yaml in the clone of the repository:\nncn-m001# cat product_vars.yaml The variables defined in the product_vars.yaml file can be used in the values that support Jinja2 templates. A variable is specified by a dot-separated path, with each component of the path representing a key in the YAML file. For example, a version of the COS product appears as follows in the product_vars.yaml file:\ncos: version: 2.4.76 This COS version can be used by specifying cos.version within a value in the input file.\nHPC CSM Software Recipe Variable Substitution Example The following example bootprep input file shows how a COS version can be used in a bootprep input file that creates a CFS configuration for computes. Only one layer is shown for brevity.\n--- configurations: - name: compute-{{recipe.version}} layers: - name: cos-compute-integration-{{cos.version}} playbook: cos-compute.yaml product: name: cos version: \u0026#34;{{cos.version}}\u0026#34; branch: integration-{{cos.version}} Note: When the value of a key in the bootprep input file is a Jinja2 expression, it must be quoted to pass YAML syntax checking.\nJinja2 expressions can also use filters and Python\u0026rsquo;s built-in string methods to manipulate the variable values. For example, suppose only the major and minor components of a COS version are to be used in the branch name for the COS layer of the CFS configuration. You can use the split string method to achieve this as follows:\n--- configurations: - name: compute-{{recipe.version}} layers: - name: cos-compute-integration-{{cos.version}} playbook: cos-compute.yaml product: name: cos version: \u0026#34;{{cos.version}}\u0026#34; branch: integration-{{cos.version.split(\u0026#39;.\u0026#39;)[0]}}-{{cos.version.split(\u0026#39;.\u0026#39;)[1]}} Dynamic Variable Substitutions Additional variables are available besides the product version variables provided by the HPC CSM Software Recipe. (For more information, see HPC CSM Software Recipe Variable Substitutions.) These additional variables are dynamic because their values are determined at run-time based on the context in which they appear. Available dynamic variables include the following:\nThe variable base.name can be used in the name of an image under the images key. The value of this variable is the name of the IMS image or recipe used as the base of this image. The variable image.name can be used in the name of a session template under the session_templates key. The value of this variable is the name of the IMS image used in this session template. These variables reduce the need to duplicate values throughout the sat bootprep input file and make the following use cases possible:\nYou want to build an image from a recipe provided by a product and use the name of the recipe in the name of the resulting image. You want to use the name of the image in the name of a session template, and the image is generated as described in the previous use case. Example Bootprep Input Files This section provides an example bootprep input file. It also gives instructions for obtaining the default bootprep input files delivered with a release of the HPC CSM Software Recipe.\nExample Bootprep Input File The following bootprep input file provides an example of using most of the features described in previous sections. It is not intended to be a complete bootprep file for the entire CSM product.\n--- configurations: - name: compute-{{recipe.version}} layers: - name: cos-compute-integration-{{cos.version}} playbook: site.yml product: name: cos version: \u0026#34;{{cos.version}}\u0026#34; branch: integration-{{cos.version}} - name: cpe-pe_deploy-integration-{{cpe.version}} playbook: pe_deploy.yml product: name: cpe version: \u0026#34;{{cpe.version}}\u0026#34; branch: integration-{{cpe.version}} images: - name: \u0026#34;{{base.name}}\u0026#34; ref_name: base_cos_image base: product: name: cos type: recipe version: \u0026#34;{{cos.version}}\u0026#34; - name: compute-{{base.name}} ref_name: compute_image base: image_ref: base_cos_image configuration: compute-{{recipe.version}} configuration_group_names: - Compute session_templates: - name: compute-{{recipe.version}} image: image_ref: compute_image configuration: compute-{{recipe.version}} bos_parameters: boot_sets: compute: kernel_parameters: ip=dhcp quiet spire_join_token=${SPIRE_JOIN_TOKEN} node_roles_groups: - Compute rootfs_provider_passthrough: \u0026#34;dvs:api-gw-service-nmn.local:300:hsn0,nmn0:0\u0026#34; Accessing Default Bootprep Input Files Default bootprep input files are delivered by the HPC CSM Software Recipe product. You can access these files by cloning the hpc-csm-software-recipe repository.\nTo do this, follow steps 1-7 of the procedure in Viewing HPC CSM Software Recipe Variables. Then, access the files in the bootprep directory of that repository:\nncn-m001# ls bootprep/ Generating an Example Bootprep Input File The sat bootprep generate-example command was not updated for recent bootprep schema changes. It is recommended that you instead use the default bootprep input files described in Accessing Default Bootprep Input Files. The sat bootprep generate-example command will be updated in a future release of SAT.\nEditing HPC CSM Software Recipe Defaults You might need to edit the default bootprep input files delivered by the HPC CSM Software Recipe for your system. Here are some examples of how to edit the files.\nEditing Default Branch Names Before running sat bootprep, HPE recommends reading the bootprep input files and paying specific attention to the branch parameters. Some HPE Cray EX products require system-specific changes on a working branch of VCS. For these products, the default bootprep input files assume certain naming conventions for the VCS branches. The files refer to a particular branch of a product\u0026rsquo;s configuration management repository.\nThus, it is important to confirm that the bootprep input files delivered by the HPC CSM Software Recipe match the actual system branch names. For example, the COS product\u0026rsquo;s CFS configuration layer is defined as follows in the default management-bootprep.yaml bootprep input file.\n- name: cos-ncn-integration-{{cos.version}} playbook: ncn.yml product: name: cos version: \u0026#34;{{cos.version}}\u0026#34; branch: integration-{{cos.version}} The default file is assuming that system-specific Ansible configuration changes for the COS product in VCS are stored in a branch named integration-{{cos.version}}. If the version being installed is COS 2.4.99, sat bootprep looks for a branch named integration-2.4.99 from which to create CFS configuration layers.\nYou can create VCS working branches that are not the default bootprep input file branch names. A simple example of this is using cne-install to update working VCS branches. If you use cne-install to update working VCS branches, (namely in the update_working_branches stage), you create or update the branches specified by the -B WORKING_BRANCH command line option. For example, consider the following cne-install command.\nncn-m001# ./cne-install install \\ -B integration \\ -s deploy_products \\ -e update_working_branches Products installed with this cne-install example use the working branch integration for system-specific changes to VCS. The branch specified by the -B option must match the branch specified in the bootprep input file.\nIn another example, to use the branch integration for COS instead of integration-{{cos.version}}, edit the bootprep input file so it reads as follows.\n- name: cos-ncn-integration-{{cos.version}} playbook: ncn.yml product: name: cos version: \u0026#34;{{cos.version}}\u0026#34; branch: integration Editing Default Management CFS Configuration Names The default bootprep input file for management CFS configurations (management-bootprep.yaml) creates configurations that have names specified within the input file. For example, in the bootprep input files included in the 22.11 HPC CSM Software Recipe, the following configurations are named:\nncn-personalization ncn-image-customization These default management CFS configuration names might be acceptable for your system. However, it is possible to create other names. sat bootprep creates whatever configurations are specified in the input file. For example, to create a NCN node personalization configuration named ncn-personalization-test, edit the file as follows.\nconfigurations: - name: ncn-personalization-test layers: ... For management configurations, use sat status to identify the current desired configuration for each of the management nodes.\nncn-m001# sat status --fields xname,role,subrole,desiredconfig --filter role=management +----------------+------------+---------+---------------------+ | xname | Role | SubRole | Desired Config | +----------------+------------+---------+---------------------+ | x3000c0s1b0n0 | Management | Master | ncn-personalization | | x3000c0s3b0n0 | Management | Master | ncn-personalization | | x3000c0s5b0n0 | Management | Master | ncn-personalization | | x3000c0s7b0n0 | Management | Worker | ncn-personalization | | x3000c0s9b0n0 | Management | Worker | ncn-personalization | | x3000c0s11b0n0 | Management | Worker | ncn-personalization | | x3000c0s13b0n0 | Management | Worker | ncn-personalization | | x3000c0s17b0n0 | Management | Storage | ncn-personalization | | x3000c0s19b0n0 | Management | Storage | ncn-personalization | | x3000c0s21b0n0 | Management | Storage | ncn-personalization | | x3000c0s25b0n0 | Management | Worker | ncn-personalization | +----------------+------------+---------+---------------------+ To overwrite the desired configuration using sat bootprep, ensure the bootprep input file specifies to create a configuration with the same name (ncn-personalization in the example above). To create a different configuration, ensure the bootprep input file specifies to create a configuration with a different name than the desired configuration (different than ncn-personalization in the example above).\nUpgrading a Single Product and Overriding its Default Version When working with a given HPC CSM Software Recipe, it might be necessary to upgrade a single HPE Cray EX product past the default version given in the recipe. However, you might still want to use the other default product versions contained in that recipe. To do this, first upgrade the single product. For more information, refer to the upgrade instructions in that product\u0026rsquo;s documentation.\nAfter the product is upgraded, you must override its default version in subsequent runs of sat bootprep. The following process explains how to do this. In this example, all the default product versions from the 22.11 software recipe are used except for COS. The COS default product version is overridden to version 2.4.199 instead, and the CFS configurations in management-bootprep.yaml are created.\nEnsure you have a local copy of the default bootprep input files.\nFor more information, see Accessing Default Bootprep Input Files.\nEdit the product_vars.yaml file to change the default product version.\nncn-m001# vim product_vars.yaml Confirm the new product version in the edited product_vars.yaml file.\nncn-m001# grep -A1 cos: `product_vars.yaml`: cos: version: 2.4.199 Use the --vars-file option when running sat bootprep to override the default product version.\nYou must run this command from the directory containing the product_vars.yaml file. The product_vars.yaml file must also be specified when using the --vars-file option. It is not sufficient to just edit the file.\nncn-m001# sat bootprep run --vars-file product_vars.yaml bootprep/management-bootprep.yaml Note: This example is specific to creating the configurations defined in management-bootprep.yaml. Review what configurations, images, or session templates you intend to create by viewing the input file.\nViewing Built-in Generated Documentation The contents of the YAML input files described above must conform to a schema which defines the structure of the data. The schema definition is written using the JSON Schema format. (Although the format is named \u0026ldquo;JSON Schema\u0026rdquo;, the schema itself is written in YAML as well.) More information, including introductory materials and a formal specification of the JSON Schema metaschema, can be found on the JSON Schema website.\nViewing the Exact Schema Specification To view the exact schema specification, run sat bootprep view-schema.\nncn-m001# sat bootprep view-schema --- $schema: \u0026#34;https://json-schema.org/draft/2020-12/schema\u0026#34; ... title: Bootprep Input File description: \u0026gt; A description of the set of CFS configurations to create, the set of IMS images to create and optionally customize with the defined CFS configurations, and the set of BOS session templates to create that reference the defined images and configurations. type: object additionalProperties: false properties: ... Generating User-Friendly Documentation The raw schema definition can be difficult to understand without experience working with JSON Schema specifications. For this reason, a feature is included that generates user-friendly HTML documentation for the input file schema. This HTML documentation can be browsed with your preferred web browser.\nCreate a documentation tarball using sat bootprep.\nncn-m001# sat bootprep generate-docs INFO: Wrote input schema documentation to /root/bootprep-schema-docs.tar.gz An alternate output directory can be specified with the --output-dir option. The generated tarball is always named bootprep-schema-docs.tar.gz.\nncn-m001# sat bootprep generate-docs --output-dir /tmp INFO: Wrote input schema documentation to /tmp/bootprep-schema-docs.tar.gz From another machine, copy the tarball to a local directory.\nanother-machine$ scp root@ncn-m001:bootprep-schema-docs.tar.gz . Extract the contents of the tarball and open the contained index.html.\nanother-machine$ tar xzvf bootprep-schema-docs.tar.gz x bootprep-schema-docs/ x bootprep-schema-docs/index.html x bootprep-schema-docs/schema_doc.css x bootprep-schema-docs/schema_doc.min.js another-machine$ open bootprep-schema-docs/index.html "
},
{
	"uri": "/docs-sat/en-24/dashboards/sat_kibana_dashboards/",
	"title": "SAT Kibana Dashboards",
	"tags": [],
	"description": "",
	"content": "SAT Kibana Dashboards Kibana is an open source analytics and visualization platform designed to search, view, and interact with data stored in Elasticsearch indices. Kibana runs as a web service and has a browser-based interface. It offers visual output of node data in the forms of charts, tables and maps that display real-time Elasticsearch queries. Viewing system data in this way breaks down the complexity of large data volumes into easily understood information.\nKibana can be accessed via web browser at the following URL:\nhttps://sma-kibana.cmn.\u0026lt;site-domain\u0026gt; The value of site-domain can be obtained as follows:\nncn-m001:~ # kubectl get secret site-init -n loftsman -o jsonpath=\u0026#39;{.data.customizations\\.yaml}\u0026#39; | \\ base64 -d | grep \u0026#34;external:\u0026#34; That command will produce the following output, for example:\nexternal: EXAMPLE_DOMAIN.com This would result in the address for Kibana being https://sma-kibana.cmn.EXAMPLE_DOMAIN.com\nFor more information on accessing the Kibana Dashboards, refer to View Logs Via Kibana in the SMA product documentation.\nAdditional details about the AER, ATOM, Heartbeat, Kernel, MCE, and RAS Daemon Kibana Dashboards are included in this table.\nDashboard Short Description Long Description Kibana Visualization and Search Name sat-aer AER corrected Corrected Advanced Error Reporting messages from PCI Express devices on each node. Visualization: aer-corrected Search: sat-aer-corrected sat-aer AER fatal Fatal Advanced Error Reporting messages from PCI Express devices on each node. Visualization: aer-fatal Search: sat-aer-fatal sat-atom ATOM failures Application Task Orchestration and Management tests are run on a node when a job finishes. Test failures are logged. sat-atom-failed sat-atom ATOM admindown Application Task Orchestration and Management test failures can result in nodes being marked admindown. An admindown node is not available for job launch. sat-atom-admindown sat-heartbeat Heartbeat loss events Heartbeat loss event messages reported by the hbtd pods that monitor for heartbeats across nodes in the system. sat-heartbeat sat-kernel Kernel assertions The kernel software performs a failed assertion when some condition represents a serious fault. The node goes down. sat-kassertions sat-kernel Kernel panics The kernel panics when something is seriously wrong. The node goes down. sat-kernel-panic sat-kernel Lustre bugs (LBUGs) The Lustre software in the kernel stack performs a failed assertion when some condition related to file system logic represents a serious fault. The node goes down. sat-lbug sat-kernel CPU stalls CPU stalls are serous conditions that can reduce node performance, and sometimes cause a node to go down. Technically these are Read-Copy-Update stalls where software in the kernel stack holds onto memory for too long. Read-Copy-Update is a vital aspect of kernel performance and rather esoteric. sat-cpu-stall sat-kernel Out of memory An Out Of Memory (OOM) condition has occurred. The kernel must kill a process to continue. The kernel will select an expendable process when possible. If there is no expendable process the node usually goes down in some manner. Even if there are expendable processes the job is likely to be impacted. OOM conditions are best avoided. sat-oom sat-mce MCE Machine Check Exceptions (MCE) are errors detected at the processor level. sat-mce sat-rasdaemon rasdaemon errors Errors from the rasdaemon service on nodes. The rasdaemon service is the Reliability, Availability, and Serviceability Daemon, and it is intended to collect all hardware error events reported by the Linux kernel, including PCI and MCE errors. This may include certain HSN errors in the future. sat-rasdaemon-error sat-rasdaemon rasdaemon messages All messages from the rasdaemon service on nodes. sat-rasdaemon Disable Search Highlighting in Kibana Dashboard By default, search highlighting is enabled. This procedure instructs how to disable search highlighting.\nThe Kibana Dashboard should be open on your system.\nNavigate to Management\nNavigate to Advanced Settings in the Kibana section, below the Elastic search section\nScroll down to the Discover section\nChange Highlight results from on to off\nClick Save to save changes\nAER Kibana Dashboard The AER Dashboard displays errors that come from the PCI Express Advanced Error Reporting (AER) driver. These errors are split up into separate visualizations depending on whether they are fatal or corrected errors.\nView the AER Kibana Dashboard Go to the dashboard section.\nSelect sat-aer dashboard.\nChoose the time range of interest.\nView the Corrected and Fatal Advanced Error Reporting messages from PCI Express devices on each node. View the matching log messages in the panel(s) on the right, and view the counts of each message per NID in the panel(s) on the left. If desired, results can be filtered by NID by clicking the icon showing a + inside a magnifying glass next to each NID.\nATOM Kibana Dashboard The ATOM (Application Task Orchestration and Management) Dashboard displays node failures that occur during health checks and application test failures. Some test failures are of possible interest even though a node is not marked admindown or otherwise fails. They are of clear interest if a node is marked admindown, and might provide clues if a node otherwise fails. They might also show application problems.\nView the ATOM Kibana Dashboard HPE Cray EX is installed on the system along with the System Admin Toolkit, which contains the ATOM Kibana Dashboard.\nGo to the dashboard section.\nSelect sat-atom dashboard.\nChoose the time range of interest.\nView any nodes marked admindown and any ATOM test failures. These failures occur during health checks and application test failures. Test failures marked admindown are important to note. View the matching log messages in the panel(s) on the right, and view the counts of each message per NID in the panel(s) on the left. If desired, results can be filtered by NID by clicking the icon showing a + inside a magnifying glass next to each NID.\nHeartbeat Kibana Dashboard The Heartbeat Dashboard displays heartbeat loss messages that are logged by the hbtd pods in the system. The hbtd pods are responsible for monitoring nodes in the system for heartbeat loss.\nView the Heartbeat Kibana Dashboard Go to the dashboard section.\nSelect sat-heartbeat dashboard.\nChoose the time range of interest.\nView the heartbeat loss messages that are logged by the hbtd pods in the system. The hbtd pods are responsible for monitoring nodes in the system for heartbeat loss. View the matching log messages in the panel.\nKernel Kibana Dashboard The Kernel Dashboard displays compute node failures such as kernel assertions, kernel panics, and Lustre LBUG messages. The messages reveal if Lustre has experienced a fatal error on any compute nodes in the system. A CPU stall is a serious problem that might result in a node failure. Out-of-memory conditions can be due to applications or system problems and may require expert analysis. They provide useful clues for some node failures and may reveal if an application is using too much memory.\nView the Kernel Kibana Dashboard Go to the dashboard section.\nSelect sat-kernel dashboard.\nChoose the time range of interest.\nView the compute node failures such as kernel assertions, kernel panics, and Lustre LBUG messages. View the matching log messages in the panel(s) on the right, and view the counts of each message per NID in the panel(s) on the left. If desired, results can be filtered by NID by clicking the icon showing a + inside a magnifying glass next to each NID.\nMCE Kibana Dashboard The MCE Dashboard displays CPU detected processor-level hardware errors.\nView the MCE Kibana Dashboard Go to the dashboard section.\nSelect sat-mce dashboard.\nChoose the time range of interest.\nView the Machine Check Exceptions (MCEs) listed including the counts per NID (node). For an MCE, the CPU number and DIMM number can be found in the message, if applicable. View the matching log messages in the panel(s) on the right, and view the counts of each message per NID in the panel(s) on the left. If desired, results can be filtered by NID by clicking the icon showing a + inside a magnifying glass next to each NID.\nRAS Daemon Kibana Dashboard The RAS Daemon Dashboard displays errors that come from the Reliability, Availability, and Serviceability (RAS) daemon service on nodes in the system. This service collects all hardware error events reported by the Linux kernel, including PCI and MCE errors. As a result there may be some duplication between the messages presented here and the messages presented in the MCE and AER dashboards. This dashboard splits up the messages into two separate visualizations, one for only messages of severity emerg or err and another for all messages from rasdaemon.\nView the RAS Daemon Kibana Dashboard Go to the dashboard section.\nSelect sat-rasdaemon dashboard.\nChoose the time range of interest.\nView the errors that come from the Reliability, Availability, and Serviceability (RAS) daemon service on nodes in the system. View the matching log messages in the panel(s) on the right, and view the counts of each message per NID in the panel(s) on the left. If desired, results can be filtered by NID by clicking the icon showing a + inside a magnifying glass next to each NID.\n"
},
{
	"uri": "/docs-sat/en-24/release_notes/",
	"title": "SAT Release Notes",
	"tags": [],
	"description": "",
	"content": "SAT Release Notes Summary of Changes in SAT 2.4 The 2.4.13 version of the SAT product includes:\nVersion 3.19.3 of the sat python package and CLI. Version 2.0.0-1 of the sat-podman wrapper script. Version 1.5.5 of the sat-install-utility container image. Version 3.3.1 of the cfs-config-util container image. Because of installation refactoring efforts, the following two components are no longer delivered with SAT:\nsat-cfs-install container image sat-cfs-install Helm chart Inclusion of SAT in CSM A version of the cray-sat container image is now included in CSM. For more information, see SAT in CSM.\nSAT Installation Improvements The SAT install.sh script no longer uses a sat-cfs-install Helm chart and container image to upload its Ansible content to the sat-config-management repository in VCS. Instead, it uses Podman to run the cf-gitea-import container directly. Some of the benefits of this change include the following:\nFewer container images that need to be managed by the SAT product Simplified SAT installation without Helm charts or Loftsman manifests Reduced SAT installation time Decoupling of cray-sat container image and cray-sat-podman package Decoupling of cray-sat Container Image and cray-sat-podman Package In older SAT releases, the sat wrapper script that was provided by the cray-sat-podman package installed on Kubernetes master NCNs included a hard-coded version of the cray-sat container image. As a result, every new version of the cray-sat image required a corresponding new version of the cray-sat-podman package.\nIn this release, this tight coupling of the cray-sat-podman package and the cray-sat container image was removed. The sat wrapper script provided by the cray-sat-podman package now looks for the version of the cray-sat container image in the /opt/cray/etc/sat/version file. This file is populated with the correct version of the cray-sat container image by the SAT layer of the CFS configuration that is applied to management NCNs. If the version file does not exist, the wrapper script defaults to the version of the cray-sat container image delivered with the latest version of CSM installed on the system.\nImproved NCN Personalization Automation The steps for performing NCN personalization as part of the SAT installation were moved out of the install.sh script and into a new update-mgmt-ncn-cfs-config.sh script that is provided in the SAT release distribution. The new script provides additional flexibility in how it modifies the NCN personalization CFS configuration for SAT. It can modify an existing CFS configuration by name, a CFS configuration being built in a JSON file, or an existing CFS configuration that applies to certain components. For more information, see Perform NCN Personalization.\nNew sat bootprep Features The following new features were added to the sat bootprep command:\nVariable substitutions using Jinja2 templates in certain fields of the sat bootprep input file\nFor more information, see HPC CSM Software Recipe Variable Substitutions and Dynamic Variable Substitutions.\nSchema version validation in the sat bootprep input files\nFor more information, see Providing a Schema Version.\nAbility to look up images and recipes provided by products\nFor more information, see Defining IMS Images.\nThe schema of the sat bootprep input files was also changed to support these new features:\nThe base recipe or image used by an image in the input file should now be specified under a base key instead of under an ims key. The old ims key is deprecated. To specify an image that depends on another image in the input file, the dependent image should specify the dependency under base.image_ref. You should no longer use the IMS name of the image on which it depends. The image used by a session template should now be specified under image.ims.name, image.ims.id, or image.image_ref. Specifying a string value directly under the image key is deprecated. For more information on defining IMS images and BOS session templates in the sat bootprep input file, see Defining IMS Images and Defining BOS Session Templates.\nAdded Blade Swap Support to sat swap The sat swap command was updated to support swapping compute and UAN blades with sat swap blade. This functionality is described in the following processes of the Cray System Management Documentation:\nAdding a Liquid-cooled blade to a System Using SAT Removing a Liquid-cooled blade from a System Using SAT Replace a Compute Blade Using SAT Swap a Compute Blade with a Different System Using SAT Support for BOS v2 A new v2 version of the Boot Orchestration Service (BOS) is available in CSM 1.3.0. SAT has added support for BOS v2. This impacts the following commands that interact with BOS:\nsat bootprep sat bootsys sat status By default, SAT uses BOS v1. However, you can choose the BOS version you want to use. For more information, see Change the BOS Version.\nAdded BOS Fields to sat status When using BOS v2, sat status outputs additional fields. These fields show the most recent BOS session, session template, booted image, and boot status for each node. An additional --bos-fields option was added to limit the output of sat status to these fields. The fields are not displayed when using BOS v1.\nOpen Source Repositories This is the first release of SAT built from open source code repositories. As a result, build infrastructure was changed to use an external Jenkins instance, and artifacts are now published to an external Artifactory instance. These changes should not impact the functionality of the SAT product in any way.\nSecurity CVE Mitigation The paramiko Python package version was updated from 2.9.2 to 2.10.1 to mitigate CVE-2022-24302. The oauthlib Python package version was updated from 3.2.0 to 3.2.1 to mitigate CVE-2022-36087. Restricted Permissions on SAT Config Files and Directories SAT stores information used to authenticate to the API gateway with Keycloak. Token files are stored in the ~/.config/sat/tokens/ directory. Those files have always had permissions appropriately set to restrict them to be readable only by the user.\nKeycloak usernames used to authenticate to the API gateway are stored in the SAT config file at /.config/sat/sat.toml. Keycloak usernames are also used in the file names of tokens stored in /.config/sat/tokens. As an additional security measure, SAT now restricts the permissions of the SAT config file to be readable and writable only by the user. It also restricts the tokens directory and the entire SAT config directory ~/.config/sat to be accessible only by the user. This prevents other users on the system from viewing Keycloak usernames used to authenticate to the API gateway.\nBug Fixes Fixed an issue where sat init did not print a message confirming a new configuration file was created. Fixed an issue where sat showrev exited with a traceback if the file /opt/cray/etc/site_info.yaml existed but was empty. This could occur if the user exited sat setrev with Ctrl-C. Fixed outdated information in the sat bootsys man page, and added a description of the command stages. Summary of Changes in SAT 2.3 The 2.3.4 version of the SAT product includes:\nVersion 3.15.4 of the sat python package and CLI Version 1.6.11 of the sat-podman wrapper script Version 1.2.0 of the sat-cfs-install container image Version 2.0.0 of the sat-cfs-install Helm chart Version 1.5.0 of the sat-install-utility container image Version 2.0.3 of the cfs-config-util container image New sat Commands None.\nCurrent Working Directory in SAT Container When running sat commands, the current working directory is now mounted in the container as /sat/share, and the current working directory within the container is also /sat/share.\nFiles in the current working directory must be specified using relative paths to that directory, because the current working directory is always mounted on /sat/share. Absolute paths should be avoided, and paths that are outside of $HOME or $PWD are never accessible to the container environment.\nThe home directory is still mounted on the same path inside the container as it is on the host.\nChanges to sat bootsys The following options were added to sat bootsys.\n--bos-limit --recursive The --bos-limit option passes a given limit string to a BOS session. The --recursive option specifies a slot or other higher-level component in the limit string\nChanges to sat bootprep The --delete-ims-jobs option was added to sat bootprep run. It deletes IMS jobs after sat bootprep is run. Jobs are no longer deleted by default.\nChanges to sat status sat status now includes information about nodes\u0026rsquo; CFS configuration statuses, such as desired configuration, configuration status, and error count.\nThe output of sat status now splits different component types into different report tables.\nThe following options were added to sat status.\n--hsm-fields, --sls-fields, --cfs-fields --bos-template The --hsm-fields, --sls-fields, --cfs-fields options limit the output columns according to specified CSM services.\nThe --bos-template option filters the status report according to the specified session template\u0026rsquo;s boot sets.\nCompatibility with CSM 1.2 The following components were modified to be compatible with CSM 1.2.\nsat-cfs-install container image and Helm chart sat-install-utility container image SAT product installer GPG Checking The sat-ncn Ansible role provided by sat-cfs-install was modified to enable GPG checks on packages while leaving GPG checks disabled on repository metadata.\nSecurity Updated urllib3 dependency to version 1.26.5 to mitigate CVE-2021-33503 and refreshed Python dependency versions.\nBug Fixes Minor bug fixes were made in each of the repositories. For full change lists, refer to each repository’s CHANGELOG.md file.\nThe known issues listed under the SAT 2.2 release were fixed.\nSummary of Changes in SAT 2.2 SAT 2.2.16 was released on February 25th, 2022.\nThis version of the SAT product included:\nVersion 3.14.0 of the sat python package and CLI Version 1.6.4 of the sat-podman wrapper script Version 1.0.4 of the sat-cfs-install container image and Helm chart It also added the following new components:\nVersion 1.4.3 of the sat-install-utility container image Version 2.0.2 of the cfs-config-util container image The following sections detail the changes in this release.\nKnown Issues in SAT 2.2 sat Command Unavailable in sat bash Shell After launching a shell within the SAT container with sat bash, the sat command will not be found. For example:\n(CONTAINER-ID) sat-container:~ # sat status bash: sat: command not found This can be resolved temporarily in one of two ways. /sat/venv/bin/ may be prepended to the $PATH environment variable:\n(CONTAINER-ID) sat-container:~ # export PATH=/sat/venv/bin:$PATH (CONTAINER-ID) sat-container:~ # sat status Or, the file /sat/venv/bin/activate may be sourced:\n(CONTAINER-ID) sat-container:~ # source /sat/venv/bin/activate (CONTAINER-ID) sat-container:~ # sat status Tab Completion Unavailable in sat bash Shell After launching a shell within the SAT container with sat bash, tab completion for sat commands does not work.\nThis can be resolved temporarily by sourcing the file /etc/bash_completion.d/sat-completion.bash:\nsource /etc/bash_completion.d/sat-completion.bash OCI Runtime Permission Error when Running sat in Root Directory sat commands will not work if the current directory is /. For example:\nncn-m001:/ # sat --help Error: container_linux.go:380: starting container process caused: process_linux.go:545: container init caused: open /dev/console: operation not permitted: OCI runtime permission denied error To resolve, run sat in another directory.\nDuplicate Mount Error when Running sat in Config Directory sat commands will not work if the current directory is ~/.config/sat. For example:\nncn-m001:~/.config/sat # sat --help Error: /root/.config/sat: duplicate mount destination To resolve, run sat in another directory.\nNew sat Commands sat bootprep automates the creation of CFS configurations, the build and customization of IMS images, and the creation of BOS session templates. For more information, see SAT Bootprep. sat slscheck performs a check for consistency between the System Layout Service (SLS) and the Hardware State Manager (HSM). sat bmccreds provides a simple interface for interacting with the System Configuration Service (SCSD) to set BMC Redfish credentials. sat hwhist displays hardware component history by XName (location) or by its Field-Replaceable Unit ID (FRUID). This command queries the Hardware State Manager (HSM) API to obtain this information. Since the sat hwhist command supports querying for the history of a component by its FRUID, the FRUID of components has been added to the output of sat hwinv. Additional Install Automation The following automation has been added to the install script, install.sh:\nWait for the completion of the sat-config-import Kubernetes job, which is started when the sat-cfs-install Helm chart is deployed. Automate the modification of the CFS configuration, which applies to master management NCNs (for example, ncn-personalization). Changes to Product Catalog Data Schema The SAT product uploads additional information to the cray-product-catalog Kubernetes ConfigMap detailing the components it provides, including container (Docker) images, Helm charts, RPMs, and package repositories.\nThis information is used to support uninstall and activation of SAT product versions moving forward.\nSupport for Uninstall and Activation of SAT Versions Beginning with the 2.2 release, SAT now provides partial support for the uninstall and activation of the SAT product stream.\nFor more information, see Uninstall: Removing a Version of SAT and Activate: Switching Between Versions.\nImprovements to sat status A Subrole column has been added to the output of sat status. This allows you to easily differentiate between master, worker, and storage nodes in the management role, for example.\nHostname information from SLS has been added to sat status output.\nAdded Support for JSON Output Support for JSON-formatted output has been added to commands which currently support the --format option, such as hwinv, status, and showrev.\nUsability Improvements Many usability improvements have been made to multiple sat commands, mostly related to filtering command output. The following are some highlights:\nAdded --fields option to display only specific fields for subcommands which display tabular reports. Added ability to filter on exact matches of a field name. Improved handling of multiple matches of a field name in --filter queries so that the first match is used, similar to --sort-by. Added support for --filter, --fields, and --reverse for summaries displayed by sat hwinv. Added borders to summary tables generated by sat hwinv. Improved documentation in the man pages. Default Log Level Changed The default log level for stderr has been changed from \u0026ldquo;WARNING\u0026rdquo; to \u0026ldquo;INFO\u0026rdquo;. For more information, see SAT Logging.\nMore Granular Log Level Configuration Options With the command-line options --loglevel-stderr and --loglevel-file, the log level can now be configured separately for stderr and the log file.\nThe existing --loglevel option is now an alias for the --loglevel-stderr option.\nPodman Wrapper Script Improvements The Podman wrapper script is the script installed at /usr/bin/sat on the master management NCNs by the cray-sat-podman RPM that runs the cray-sat container in podman. The following subsections detail improvements that were made to the wrapper script in this release.\nMounting of $HOME and Current Directories in cray-sat Container The Podman wrapper script that launches the cray-sat container with podman has been modified to mount the user\u0026rsquo;s current directory and home directory into the cray-sat container to provide access to local files in the container.\nPodman Wrapper Script Documentation Improvements The man page for the Podman wrapper script, which is accessed by typing man sat on a master management NCN, has been improved to document the following:\nEnvironment variables that affect execution of the wrapper script Host files and directories mounted in the container Fixes to Podman Wrapper Script Output Redirection Fixed issues with redirecting stdout and stderr, and piping output to commands, such as awk, less, and more.\nConfigurable HTTP Timeout A new sat option has been added to configure the HTTP timeout length for requests to the API gateway. For more information, refer to sat-man sat.\nsat bootsys Improvements Many improvements and fixes have been made to sat bootsys. The following are some highlights:\nAdded the --excluded-ncns option, which can be used to omit NCNs from the platform-services and ncn-power stages in case they are inaccessible. Disruptive shutdown stages in sat bootsys shutdown now prompt the user to continue before proceeding. A new option, --disruptive, will bypass this. Improvements to Ceph service health checks and restart during the platform-services stage of sat bootsys boot. sat xname2nid Improvements sat xname2nid can now recursively expand slot, chassis, and cabinet XNames to a list of NIDs in those locations.\nA new --format option has been added to sat xname2nid. It sets the output format to either \u0026ldquo;range\u0026rdquo; (the default) or \u0026ldquo;NID\u0026rdquo;. The \u0026ldquo;range\u0026rdquo; format displays NIDs in a compressed range format suitable for use with a workload manager like Slurm.\nUsage of v2 HSM API The commands which interact with HSM (for example, sat status and sat hwinv) now use the v2 HSM API.\nsat diag Limited to HSN Switches sat diag will now only operate against HSN switches by default. These are the only controllers that support running diagnostics with HMJTD.\nsat showrev Enhancements A column has been added to the output of sat showrev that indicates whether a product version is \u0026ldquo;active\u0026rdquo;. The definition of \u0026ldquo;active\u0026rdquo; varies across products, and not all products may set an \u0026ldquo;active\u0026rdquo; version.\nFor SAT, the active version is the one with its hosted-type package repository in Nexus set as the member of the group-type package repository in Nexus, meaning that it will be used when installing the cray-sat-podman RPM.\ncray-sat Container Image Size Reduction The size of the cray-sat container image has been approximately cut in half by leveraging multi-stage builds. This also improved the repeatability of the unit tests by running them in the container.\nBug Fixes Minor bug fixes were made in cray-sat and in cray-sat-podman. For full change lists, refer to each repository\u0026rsquo;s CHANGELOG.md file.\nSummary of SAT Changes in Shasta v1.5 We released version 2.1.16 of the SAT product in Shasta v1.5.\nThis version of the SAT product included:\nVersion 3.7.4 of the sat python package and CLI Version 1.4.10 of the sat-podman wrapper script It also added the following new component:\nVersion 1.0.3 of the sat-cfs-install docker image and helm chart The following sections detail the changes in this release.\nInstall Changes to Separate Product from CSM This release further decouples the installation of the SAT product from the CSM product. The cray-sat-podman RPM is no longer installed in the management non-compute node (NCN) image. Instead, the cray-sat-podman RPM is installed on all master management NCNs via an Ansible playbook which is referenced by a layer of the CFS configuration that applies to management NCNs. This CFS configuration is typically named ncn-personalization.\nThe SAT product now includes a Docker image and a Helm chart named sat-cfs-install. The SAT install script, install.sh, deploys the Helm chart with Loftsman. This helm chart deploys a Kubernetes job that imports the SAT Ansible content to a git repository in VCS (Gitea) named sat-config-management. This repository is referenced by the layer added to the NCN personalization CFS configuration.\nRemoval of Direct Redfish Access All commands which used to access Redfish directly have either been removed or modified to use higher-level service APIs. This includes the following commands:\nsat sensors sat diag sat linkhealth The sat sensors command has been rewritten to use the SMA telemetry API to obtain the latest sensor values. The command\u0026rsquo;s usage has changed slightly, but legacy options work as before, so it is backwards compatible. Additionally, new commands have been added.\nThe sat diag command has been rewritten to use a new service called Fox, which is delivered with the CSM-Diags product. The sat diag command now launches diagnostics using the Fox service, which launches the corresponding diagnostic programs on controllers using the Hardware Management Job and Task Daemon (HMJTD) over Redfish. Essentially, Fox serves as a proxy for us to start diagnostics over Redfish.\nThe sat linkhealth command has been removed. Its functionality has been replaced by functionality from the Slingshot Topology Tool (STT) in the fabric manager pod.\nThe Redfish username and password command line options and config file options have been removed. For more information, see Remove Obsolete Configuration File Sections.\nAdditional Fields in sat setrev and sat showrev sat setrev now collects the following information from the admin, which is then displayed by sat showrev:\nSystem description Product number Company name Country code Additional guidance and validation has been added to each field collected by sat setrev. This sets the stage for sdu setup to stop collecting this information and instead collect it from sat showrev or its S3 bucket.\nImprovements to sat bootsys The platform-services stage of the sat bootsys boot command has been improved to start inactive Ceph services, unfreeze Ceph, and wait for Ceph health in the correct order. The ceph-check stage has been removed as it is no longer needed.\nThe platform-services stage of sat bootsys boot now prompts for confirmation of the storage NCN hostnames in addition to the Kubernetes masters and workers.\nBug Fixes and Security Fixes Improved error handling in sat firmware. Incremented version of Alpine Linux to 3.13.2 to address a security vulnerability. Other Notable Changes Ansible has been removed from the cray-sat container image. Support for the Firmware Update Service (FUS) has been removed from the sat firmware command. Summary of SAT Changes in Shasta v1.4.1 We released version 2.0.4 of the SAT product in Shasta v1.4.1.\nThis version of the SAT product included:\nVersion 3.5.0 of the sat python package and CLI. Version 1.4.3 of the sat-podman wrapper script. The following sections detail the changes in this release.\nNew Commands to Translate Between NIDs and XNames Two new commands were added to translate between NIDs and XNames:\nsat nid2xname sat xname2nid These commands perform this translation by making requests to the Hardware State Manager (HSM) API.\nBug Fixes Fixed a problem in sat swap where creating the offline port policy failed. Changed sat bootsys shutdown --stage bos-operations to no longer forcefully power off all compute nodes and application nodes using CAPMC when BOS sessions complete or time out. Fixed an issue with the command sat bootsys boot --stage cabinet-power. Summary of SAT Changes in Shasta v1.4 In Shasta v1.4, SAT became an independent product, which meant we began to designate a version number for the entire SAT product. We released version 2.0.3 of the SAT product in Shasta v1.4.\nThis version of the SAT product included the following components:\nVersion 3.4.0 of the sat python package and CLI It also added the following new component:\nVersion 1.4.2 of the sat-podman wrapper script The following sections detail the changes in this release.\nSAT as an Independent Product SAT is now packaged and released as an independent product. The product deliverable is called a \u0026ldquo;release distribution\u0026rdquo;. The release distribution is a gzipped tar file containing an install script. This install script loads the cray/cray-sat container image into the Docker registry in Nexus and loads the cray-sat-podman RPM into a package repository in Nexus.\nIn this release, the cray-sat-podman package is still installed in the master and worker NCN images provided by CSM. This is changed in SAT 2.1.16 released in Shasta v1.5.\nSAT Running in a Container Under Podman The sat command now runs in a container under Podman. The sat executable is now installed on all nodes in the Kubernetes management cluster (workers and masters). This executable is a wrapper script that starts a SAT container in Podman and invokes the sat Python CLI within that container. The admin can run individual sat commands directly on the master or worker NCNs as before, or they can run sat commands inside the SAT container after using sat bash to enter an interactive shell inside the SAT container.\nTo view man pages for sat commands, the user can run sat-man SAT_COMMAND, replacing SAT_COMMAND with the name of the sat command. Alternatively, the user can enter the sat container with sat bash and use the man command.\nNew sat init Command and Config File Location Change The default location of the SAT config file has been changed from /etc/sat.toml to ~/.config/sat/sat.toml. A new command, sat init, has been added that initializes a configuration file in the new default directory. This better supports individual users on the system who want their own config files.\n~/.config/sat is mounted into the container that runs under Podman, so changes are persistent across invocations of the sat container. If desired, an alternate configuration directory can be specified with the SAT_CONFIG_DIR environment variable.\nAdditionally, if a config file does not yet exist when a user runs a sat command, one is generated automatically.\nAdditional Types Added to sat hwinv Additional functionality has been added to sat hwinv including:\nList node enclosure power supplies with the --list-node-enclosure-power-supplies option. List node accelerators (for example, GPUs) with the --list-node-accels option. The count of node accelerators is also included for each node. List node accelerator risers (for example, Redstone modules) with the --list-node-accel-risers option. The count of node accelerator risers is also included for each node. List High-Speed Node Network Interface Cards (HSN NICs) with the --list-node-hsn-nics option. The count of HSN NICs is also included for each node. Documentation for these new options has been added to the man page for sat hwinv.\nSite Information Stored by sat setrev in S3 The sat setrev and sat showrev commands now use S3 to store and obtain site information, including system name, site name, serial number, install date, and system type. Since the information is stored in S3, it will now be consistent regardless of the node on which sat is executed.\nAs a result of this change, S3 credentials must be configured for SAT. For more information, see Generate SAT S3 Credentials.\nProduct Version Information Shown by sat showrev sat showrev now shows product information from the cray-product-catalog ConfigMap in Kubernetes.\nAdditional Changes to sat showrev The output from sat showrev has also been changed in the following ways:\nThe --docker and --packages options were considered misleading and have been removed. Information pertaining to only to the local host, where the command is run, has been moved to the output of the --local option. Removal of sat cablecheck The sat cablecheck command has been removed. To verify that the system\u0026rsquo;s Slingshot network is cabled correctly, admins should now use the show cables command in the Slingshot Topology Tool (STT).\nsat swap Command Compatibility with Next-gen Fabric Controller The sat swap command was added in Shasta v1.3.2. This command used the Fabric Controller API. Shasta v1.4 introduced a new Fabric Manager API and removed the Fabric Controller API, so this command has been rewritten to use the new backwards-incompatible API. Usage of the command did not change.\nsat bootsys Functionality Much of the functionality added to sat bootsys in Shasta v1.3.2 was broken by changes introduced in Shasta v1.4, which removed the Ansible inventory and playbooks.\nThe functionality in the platform-services stage of sat bootsys has been re-implemented to use python directly instead of Ansible. This resulted in a more robust procedure with better logging to the sat log file. Failures to stop containers on Kubernetes nodes are handled more gracefully, and more information about the containers that failed to stop, including how to debug the problem, is included.\nImprovements were made to console logging setup for non-compute nodes (NCNs) when they are shut down and booted.\nThe following improvements were made to the bos-operations stage of sat bootsys:\nMore information about the BOS sessions, BOA jobs, and BOA pods is printed. A command-line option, --bos-templates, and a corresponding config-file option, bos_templates, were added, and the --cle-bos-template and --uan-bos-template options and their corresponding config file options were deprecated. The following functionality has been removed from sat bootsys:\nThe hsn-bringup stage of sat bootsys boot has been removed due to removal of the underlying Ansible playbook. The bgp-check stage of sat bootys {boot,shutdown} has been removed. It is now a manual procedure. Log File Location Change The location of the sat log file has changed from /var/log/cray/sat.log to /var/log/cray/sat/sat.log. This change simplifies mounting this file into the sat container running under Podman.\nSummary of SAT Changes in Shasta v1.3.2 Shasta v1.3.2 included version 2.4.0 of the sat python package and CLI.\nThe following sections detail the changes in this release.\nsat swap Command for Switch and Cable Replacement The sat switch command which supported operations for replacing a switch has been deprecated and replaced with the sat swap command, which now supports replacing a switch OR cable.\nThe sat swap switch command is equivalent to sat switch. The sat switch command will be removed in a future release.\nAddition of Stages to sat bootsys Command The sat bootsys command now has multiple stages for both the boot and shutdown actions. Please refer to the \u0026ldquo;System Power On Procedures\u0026rdquo; and \u0026ldquo;System Power Off Procedures\u0026rdquo; sections of the Cray Shasta Administration Guide (S-8001) for more details on using this command in the context of a full system power off and power on.\nSummary of SAT Changes in Shasta v1.3 Shasta v1.3 included version 2.2.3 of the sat python package and CLI.\nThis version of the sat CLI contained the following commands:\nauth bootsys cablecheck diag firmware hwinv hwmatch k8s linkhealth sensors setrev showrev status swap switch For more information on each of these commands, see the System Admin Toolkit Command Overview and the table of commands in the SAT Authentication section of this document.\n"
},
{
	"uri": "/docs-sat/en-24/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/docs-sat/en-24/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
}]