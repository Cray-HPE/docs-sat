<!DOCTYPE html>
<html lang="en-23" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.123.0">
    <meta name="description" content="">


    <link rel="icon" href="/docs-sat/images/favicon.png" type="image/png">

    <title>SAT Installation :: System Admin Toolkit (SAT)</title>

    
    <link href="/docs-sat/css/nucleus.css?1729740967" rel="stylesheet">
    <link href="/docs-sat/css/fontawesome-all.min.css?1729740967" rel="stylesheet">
    <link href="/docs-sat/css/hybrid.css?1729740967" rel="stylesheet">
    <link href="/docs-sat/css/featherlight.min.css?1729740967" rel="stylesheet">
    <link href="/docs-sat/css/perfect-scrollbar.min.css?1729740967" rel="stylesheet">
    <link href="/docs-sat/css/auto-complete.css?1729740967" rel="stylesheet">
    <link href="/docs-sat/css/atom-one-dark-reasonable.css?1729740967" rel="stylesheet">
    <link href="/docs-sat/css/theme.css?1729740967" rel="stylesheet">
    <link href="/docs-sat/css/tabs.css?1729740967" rel="stylesheet">
    <link href="/docs-sat/css/hugo-theme.css?1729740967" rel="stylesheet">
    
    <link href="/docs-sat/css/theme-blue.css?1729740967" rel="stylesheet">
    
    

    <script src="/docs-sat/js/jquery-3.3.1.min.js?1729740967"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/docs-sat/en-23/install/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href='/docs-sat/en-23'>
  System Admin Toolkit
</a>

    </div>

    
    <section>
      <ul>
      
        <li>
          <div class="select-style padding">
          v <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en-26" value="/docs-sat/en-26/install/">2.6</option>
                    
                  
              
                  
              
                  
              
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="en-25" value="/docs-sat/en-25/install/">2.5</option>
                    
                  
              
                  
              
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
                    
                    
                      <option id="en-24" value="/docs-sat/en-24/install/">2.4</option>
                    
                  
              
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
              
                  
                    
                    
                      <option id="en-23" value="/docs-sat/en-23/install/" selected>2.3</option>
                    
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
              
                  
              
                  
                    
                    
                      <option id="en-22" value="/docs-sat/en-22/install/">2.2</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
              
                  
              
                  
              
                  
                    
                    
                      <option id="en-21" value="/docs-sat/en-21/install/">2.1</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </li>
      

      
      </ul>
    </section>
  

    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/docs-sat/js/lunr.min.js?1729740967"></script>
<script type="text/javascript" src="/docs-sat/js/auto-complete.js?1729740967"></script>
<script type="text/javascript">
    
        var baseurl = "\/docs-sat\/\/en-23";
    
</script>
<script type="text/javascript" src="/docs-sat/js/search.js?1729740967"></script>

    
  </div>

  

    <div class="highlightable">
    <ul class="topics">
      
      




 
  
    
      <li data-nav-id="/docs-sat/en-23/introduction/" title="Introduction to SAT" class="dd-item ">
        <a href="/docs-sat/en-23/introduction/">
        Introduction to SAT
        
        </a>
    </li>
     
  
 

      
      




 
  
    
    <li data-nav-id="/docs-sat/en-23/dashboards/" title="SAT Dashboards" class="dd-item
        
        
        
        ">
      <a href="/docs-sat/en-23/dashboards/">
          SAT Dashboards
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-sat/en-23/dashboards/sat_grafana_dashboards/" title="SAT Grafana Dashboards" class="dd-item ">
        <a href="/docs-sat/en-23/dashboards/sat_grafana_dashboards/">
        SAT Grafana Dashboards
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-sat/en-23/dashboards/sat_kibana_dashboards/" title="SAT Kibana Dashboards" class="dd-item ">
        <a href="/docs-sat/en-23/dashboards/sat_kibana_dashboards/">
        SAT Kibana Dashboards
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
      




 
  
    
      <li data-nav-id="/docs-sat/en-23/install/" title="SAT Installation" class="dd-item active">
        <a href="/docs-sat/en-23/install/">
        SAT Installation
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-sat/en-23/release_notes/" title="SAT Release Notes" class="dd-item ">
        <a href="/docs-sat/en-23/release_notes/">
        SAT Release Notes
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-sat/en-23/usage/" title="SAT Usage" class="dd-item ">
        <a href="/docs-sat/en-23/usage/">
        SAT Usage
        
        </a>
    </li>
     
  
 

      
    </ul>

    
    

    
    <section id="footer">
      
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/docs-sat/en-23/'>HPE Cray EX System Admin Toolkit (SAT) Guide</a> > SAT Installation
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#install-the-system-admin-toolkit-product-stream">Install the System Admin Toolkit Product Stream</a>
      <ul>
        <li><a href="#prerequisites">Prerequisites</a></li>
        <li><a href="#notes-on-the-procedures">Notes on the Procedures</a></li>
        <li><a href="#pre-installation-procedure">Pre-Installation Procedure</a></li>
        <li><a href="#installation-procedure">Installation Procedure</a></li>
        <li><a href="#post-installation-procedure">Post-Installation Procedure</a></li>
        <li><a href="#next-steps">Next Steps</a></li>
      </ul>
    </li>
    <li><a href="#perform-ncn-personalization">Perform NCN Personalization</a>
      <ul>
        <li><a href="#prerequisites-1">Prerequisites</a></li>
        <li><a href="#notes-on-the-procedure">Notes on the Procedure</a></li>
        <li><a href="#procedure">Procedure</a></li>
        <li><a href="#next-steps-1">Next Steps</a></li>
      </ul>
    </li>
    <li><a href="#sat-authentication">SAT Authentication</a>
      <ul>
        <li><a href="#description-of-sat-command-authentication-types">Description of SAT Command Authentication Types</a></li>
        <li><a href="#prerequisites-2">Prerequisites</a></li>
        <li><a href="#procedure-1">Procedure</a></li>
      </ul>
    </li>
    <li><a href="#generate-sat-s3-credentials">Generate SAT S3 Credentials</a>
      <ul>
        <li><a href="#prerequisites-3">Prerequisites</a></li>
        <li><a href="#procedure-2">Procedure</a></li>
      </ul>
    </li>
    <li><a href="#run-sat-setrev-to-set-system-information">Run sat setrev to Set System Information</a>
      <ul>
        <li><a href="#prerequisites-4">Prerequisites</a></li>
        <li><a href="#procedure-3">Procedure</a></li>
      </ul>
    </li>
    <li><a href="#remove-obsolete-configuration-file-sections">Remove obsolete configuration file sections</a>
      <ul>
        <li><a href="#prerequisites-5">Prerequisites</a></li>
        <li><a href="#procedure-4">Procedure</a></li>
      </ul>
    </li>
    <li><a href="#sat-logging">SAT Logging</a>
      <ul>
        <li><a href="#update-configuration">Update Configuration</a></li>
        <li><a href="#affected-commands">Affected Commands</a></li>
      </ul>
    </li>
    <li><a href="#uninstall-removing-a-version-of-sat">Uninstall: Removing a Version of SAT</a>
      <ul>
        <li><a href="#prerequisites-6">Prerequisites</a></li>
        <li><a href="#procedure-5">Procedure</a></li>
      </ul>
    </li>
    <li><a href="#activate-switching-between-versions">Activate: Switching Between Versions</a>
      <ul>
        <li><a href="#prerequisites-7">Prerequisites</a></li>
        <li><a href="#procedure-6">Procedure</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
            </h1>
          

        


<h1 id="sat-installation">SAT Installation</h1>
<h2 id="install-the-system-admin-toolkit-product-stream">Install the System Admin Toolkit Product Stream</h2>
<p>Describes how to install the System Admin Toolkit (SAT) product stream.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>CSM is installed and verified.</li>
<li>cray-product-catalog is running.</li>
<li>There must be at least 2 gigabytes of free space on the manager NCN on which the
procedure is run.</li>
</ul>
<h3 id="notes-on-the-procedures">Notes on the Procedures</h3>
<ul>
<li>Ellipses (<code>...</code>) in shell output indicate omitted lines.</li>
<li>In the examples below, replace <code>2.2.x</code> with the version of the SAT product stream
being installed.</li>
<li>&lsquo;manager&rsquo; and &lsquo;master&rsquo; are used interchangeably in the steps below.</li>
<li>To upgrade SAT, execute the pre-installation, installation, and post-installation
procedures for a newer distribution. The newly installed version will become
the default.</li>
</ul>
<h3 id="pre-installation-procedure">Pre-Installation Procedure</h3>
<ol>
<li>
<p>Start a typescript.</p>
<p>The typescript will record the commands and the output from this installation.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# script -af product-sat.$(date +%Y-%m-%d).txt
ncn-m001# export PS1=&#39;\u@\H \D{%Y-%m-%d} \t \w # &#39;
</code></pre></li>
</ol>
<h3 id="installation-procedure">Installation Procedure</h3>
<ol>
<li>
<p>Copy the release distribution gzipped tar file to <code>ncn-m001</code>.</p>
</li>
<li>
<p>Unzip and extract the release distribution, <code>2.2.x</code>.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# tar -xvzf sat-2.2.x.tar.gz
</code></pre></li>
<li>
<p>Change directory to the extracted release distribution directory.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# cd sat-2.2.x
</code></pre></li>
<li>
<p>Run the installer: <strong>install.sh</strong>.</p>
<p>The script produces a lot of output. A successful install ends with &ldquo;SAT
version 2.2.x has been installed&rdquo;.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# ./install.sh
...
====&gt; Updating active CFS configurations
...
====&gt; SAT version 2.2.x has been installed.
</code></pre></li>
<li>
<p><strong>Upgrade only</strong>: Record the names of the CFS configuration or
configurations modified by <code>install.sh</code>.</p>
<p>The <code>install.sh</code> script attempts to modify any CFS configurations that apply
to the master management NCNs. During an upgrade, <code>install.sh</code> will log
messages indicating the CFS configuration or configurations that were
modified. For example, if there are three master nodes all using the same
CFS configuration named &ldquo;ncn-personalization&rdquo;, the output would look like
this:</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">====&gt; Updating active CFS configurations
INFO: Querying CFS configurations for the following NCNs: x3000c0s1b0n0, x3000c0s3b0n0, x3000c0s5b0n0
INFO: Found configuration &#34;ncn-personalization&#34; for component x3000c0s1b0n0
INFO: Found configuration &#34;ncn-personalization&#34; for component x3000c0s3b0n0
INFO: Found configuration &#34;ncn-personalization&#34; for component x3000c0s5b0n0
INFO: Updating CFS configuration &#34;ncn-personalization&#34;
INFO: Updating existing layer with repo path /vcs/cray/sat-config-management.git and playbook sat-ncn.yml in configuration &#34;ncn-personalization&#34;.
INFO: Key &#34;name&#34; in layer with repo path /vcs/cray/sat-config-management.git and playbook sat-ncn.yml updated from sat-ncn to sat-2.2.16
INFO: Successfully updated layers in configuration &#34;ncn-personalization&#34;
</code></pre><p>Save the name of each CFS configuration updated by the installer. In the
previous example, a single configuration named &ldquo;ncn-personalization&rdquo; was
updated, so that name is saved to a temporary file.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# echo ncn-personalization &gt;&gt; /tmp/sat-ncn-cfs-configurations.txt
</code></pre><p>Repeat the previous command for each CFS configuration that was updated.</p>
</li>
<li>
<p><strong>Upgrade only</strong>: Save the new name of the SAT CFS configuration layer.</p>
<p>In the example <code>install.sh</code> output above, the new layer name is
<code>sat-2.2.16</code>. Save this value to a file to be used later.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# echo sat-2.2.16 &gt; /tmp/sat-layer-name.txt
</code></pre></li>
<li>
<p><strong>Fresh install only</strong>: Save the CFS configuration layer for SAT to a file
for later use.</p>
<p>The <code>install.sh</code> script attempts to modify any CFS configurations that apply
to the master management NCNs. During a fresh install, no such CFS
configurations will be found, and it will instead log the SAT configuration
layer that must be added to the CFS configuration that will be created. Here
is an example of the output in that case:</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">====&gt; Updating active CFS configurations
INFO: Querying CFS configurations for the following NCNs: x3000c0s1b0n0, x3000c0s3b0n0, x3000c0s5b0n0
WARNING: No CFS configurations found that apply to components with role Management and subrole Master.
INFO: The following sat layer should be used in the CFS configuration that will be applied to NCNs with role Management and subrole Master.
{
    &#34;name&#34;: &#34;sat-2.2.15&#34;,
    &#34;commit&#34;: &#34;9a74b8f5ba499af6fbcecfd2518a40e081312933&#34;,
    &#34;cloneUrl&#34;: &#34;https://api-gw-service-nmn.local/vcs/cray/sat-config-management.git&#34;,
    &#34;playbook&#34;: &#34;sat-ncn.yml&#34;
}
</code></pre><p>Save the JSON output to a file for later use. For example:</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# cat &gt; /tmp/sat-layer.json &lt;&lt;EOF
&gt; {
&gt;     &#34;name&#34;: &#34;sat-2.2.15&#34;,
&gt;     &#34;commit&#34;: &#34;9a74b8f5ba499af6fbcecfd2518a40e081312933&#34;,
&gt;     &#34;cloneUrl&#34;: &#34;https://api-gw-service-nmn.local/vcs/cray/sat-config-management.git&#34;,
&gt;     &#34;playbook&#34;: &#34;sat-ncn.yml&#34;
&gt; }
&gt; EOF
</code></pre><p>Do not copy the previous command verbatim. Use the JSON output from the
<code>install.sh</code> script.</p>
</li>
</ol>
<h3 id="post-installation-procedure">Post-Installation Procedure</h3>
<ol>
<li>
<p><strong>Optional:</strong> Remove the SAT release distribution tar file and extracted directory.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# rm sat-2.2.x.tar.gz
ncn-m001# rm -rf sat-2.2.x/
</code></pre></li>
<li>
<p><strong>Upgrade only</strong>: Ensure that the environment variable <code>SAT_TAG</code> is not set
in the <code>~/.bashrc</code> file on any of the management NCNs.</p>
<p><strong>NOTE</strong>: This step should only be required when updating from
Shasta 1.4.1 or Shasta 1.4.2.</p>
<p>The following example assumes three manager NCNs: <code>ncn-m001</code>, <code>ncn-m002</code>, and <code>ncn-m003</code>,
and shows output from a system in which no further action is needed.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# pdsh -w ncn-m00[1-3] cat ~/.bashrc
ncn-m001: source &lt;(kubectl completion bash)
ncn-m003: source &lt;(kubectl completion bash)
ncn-m002: source &lt;(kubectl completion bash)
</code></pre><p>The following example shows that <code>SAT_TAG</code> is set in <code>~/.bashrc</code> on <code>ncn-m002</code>.
Remove that line from the <code>~/.bashrc</code> file on <code>ncn-m002</code>.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# pdsh -w ncn-m00[1-3] cat ~/.bashrc
ncn-m001: source &lt;(kubectl completion bash)
ncn-m002: source &lt;(kubectl completion bash)
ncn-m002: export SAT_TAG=3.5.0
ncn-m003: source &lt;(kubectl completion bash)
</code></pre></li>
<li>
<p>Stop the typescript.</p>
<p><strong>NOTE</strong>: This step can be skipped if you wish to use the same typescript
for the remainder of the SAT install. See <a href="/docs-sat/en-23/#next-steps">Next Steps</a>.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# exit
</code></pre></li>
</ol>
<p>SAT version <code>2.2.x</code> is now installed/upgraded, meaning the SAT <code>2.2.x</code> release
has been loaded into the system software repository.</p>
<ul>
<li>SAT configuration content for this release has been uploaded to VCS.</li>
<li>SAT content for this release has been uploaded to the CSM product catalog.</li>
<li>SAT content for this release has been uploaded to Nexus repositories.</li>
<li>The <code>sat</code> command won&rsquo;t be available until the <a href="/docs-sat/en-23/#perform-ncn-personalization">NCN Personalization</a>
procedure has been executed.</li>
</ul>
<h3 id="next-steps">Next Steps</h3>
<p>If other HPE Cray EX software products are being installed or upgraded in conjunction
with SAT, refer to the <a href="https://www.hpe.com/support/ex-gsg"><em>HPE Cray EX System Software Getting Started Guide</em></a>
to determine which step to execute next.</p>
<p>If no other HPE Cray EX software products are being installed or upgraded at this time,
proceed to the sections listed below.</p>
<p><strong>NOTE:</strong> The <strong>NCN Personalization</strong> procedure <strong>is required when
upgrading SAT</strong>. The setup procedures in <strong>SAT Setup</strong>, however, are
<strong>not required when upgrading SAT</strong>. They should have been executed
during the first installation of SAT.</p>
<p>Execute the <strong>NCN Personalization</strong> procedure:</p>
<ul>
<li><a href="/docs-sat/en-23/#perform-ncn-personalization">Perform NCN Personalization</a></li>
</ul>
<p>If performing a fresh install, execute the <strong>SAT Setup</strong> procedures:</p>
<ul>
<li><a href="/docs-sat/en-23/#sat-authentication">SAT Authentication</a></li>
<li><a href="/docs-sat/en-23/#generate-sat-s3-credentials">Generate SAT S3 Credentials</a></li>
<li><a href="/docs-sat/en-23/#run-sat-setrev-to-set-system-information">Run Sat Setrev to Set System Information</a></li>
</ul>
<p>If performing an upgrade, execute the <strong>upgrade</strong> procedures:</p>
<ul>
<li><a href="/docs-sat/en-23/#remove-obsolete-configuration-file-sections">Remove obsolete configuration file sections</a></li>
<li><a href="/docs-sat/en-23/#sat-logging">SAT Logging</a></li>
</ul>
<h2 id="perform-ncn-personalization">Perform NCN Personalization</h2>
<p>Describes how to perform NCN personalization using CFS. This personalization process
will configure the System Admin Toolkit (SAT) product stream.</p>
<h3 id="prerequisites-1">Prerequisites</h3>
<ul>
<li>The <a href="/docs-sat/en-23/#install-the-system-admin-toolkit-product-stream">Install the System Admin Toolkit Product Stream</a>
procedure has been successfully completed.</li>
<li>If upgrading, the names of the CFS configurations updated during installation
were saved to the file <code>/tmp/sat-ncn-cfs-configurations.txt</code>.</li>
<li>If upgrading, the name of the new SAT CFS configuration layer was saved to
the file <code>/tmp/sat-layer-name.txt</code>.</li>
<li>If performing a fresh install, the SAT CFS configuration layer was saved to
the file <code>/tmp/sat-layer.json</code>.</li>
</ul>
<h3 id="notes-on-the-procedure">Notes on the Procedure</h3>
<ul>
<li>Ellipses (<code>...</code>) in shell output indicate omitted lines.</li>
<li>In the examples below, replace <code>2.2.x</code> with the version of the SAT product stream
being installed.</li>
<li>&lsquo;manager&rsquo; and &lsquo;master&rsquo; are used interchangeably in the steps below.</li>
<li>If upgrading SAT, the existing configuration will likely include other Cray EX product
entries. Update the SAT entry as described in this procedure. The <em>HPE Cray EX System
Software Getting Started Guide</em> provides guidance on how and when to update the
entries for the other products.</li>
</ul>
<h3 id="procedure">Procedure</h3>
<ol>
<li>
<p>Start a typescript if not already using one.</p>
<p>The typescript will capture the commands and the output from this installation procedure.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# script -af product-sat.$(date +%Y-%m-%d).txt
ncn-m001# export PS1=&#39;\u@\H \D{%Y-%m-%d} \t \w # &#39;
</code></pre></li>
<li>
<p><strong>Fresh install only</strong>: Add the SAT layer to the NCN personalization JSON file.</p>
<p>If the SAT install script, <code>install.sh</code>, did not identify and modify the CFS
configurations that apply to each master management NCN, it will have printed
the SAT CFS configuration layer in JSON format. This layer must be added to
the JSON file being used to construct the CFS configuration. For example,
if the file being used is named <code>ncn-personalization.json</code>, and the SAT
layer was saved to the file <code>/tmp/sat-layer.json</code> as described in the
install instructions, the following <code>jq</code> command will append the SAT layer
and save the result in a new file named <code>ncn-personalization.json</code>.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# jq -s &#39;{layers: (.[0].layers + [.[1]])}&#39; ncn-personalization.json \
    /tmp/sat-layer.json &gt; ncn-personalization.new.json
</code></pre><p>For instructions on how to create a CFS configuration from the previous
file and how to apply it to the management NCNs, refer to &ldquo;Perform NCN
Personalization&rdquo; in the <em>HPE Cray System Management Documentation</em>. After
the CFS configuration has been created and applied, return to this
procedure.</p>
</li>
<li>
<p><strong>Upgrade only</strong>: Invoke each CFS configuration that was updated during the
upgrade.</p>
<p>If the SAT install script, <code>install.sh</code>, identified CFS configurations that
apply to the master management NCNs and modified them in place, invoke each
CFS configuration that was created or updated during installation.</p>
<p>This step will create a CFS session for each given configuration and install
SAT on the associated manager NCNs.</p>
<p>The <code>--configuration-limit</code> option limits the configuration session to run
only the SAT layer of the configuration.</p>
<p>You should see a representation of the CFS session in the output.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# for cfs_configuration in $(cat /tmp/sat-ncn-cfs-configurations.txt);
do cray cfs sessions create --name &#34;sat-session-${cfs_configuration}&#34; --configuration-name \
    &#34;${cfs_configuration}&#34; --configuration-limit $(cat /tmp/sat-layer-name.txt);
done

name=&#34;sat-session-ncn-personalization&#34;

[ansible]
...
</code></pre></li>
<li>
<p><strong>Upgrade only</strong>: Monitor the progress of each CFS session.</p>
<p>This step assumes a single session named <code>sat-session-ncn-personalization</code> was created in the previous step.</p>
<p>First, list all containers associated with the CFS session:</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# kubectl get pod -n services --selector=cfsession=sat-session-ncn-personalization \
    -o json | jq &#39;.items[0].spec.containers[] | .name&#39;
&#34;inventory&#34;
&#34;ansible-1&#34;
&#34;istio-proxy&#34;
</code></pre><p>Next, get the logs for the <code>ansible-1</code> container.</p>
<p><strong>NOTE:</strong> the trailing digit might differ from &ldquo;1&rdquo;. It is the zero-based
index of the <code>sat-ncn</code> layer within the configuration&rsquo;s layers.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# kubectl logs -c ansible-1 --tail 100 -f -n services \
    --selector=cfsession=sat-session-ncn-personalization
</code></pre><p>Ansible plays, which are run by the CFS session, will install SAT on all the
manager NCNs on the system. Successful results for all of the manager NCN xnames
can be found at the end of the container log. For example:</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">...
PLAY RECAP *********************************************************************
x3000c0s1b0n0              : ok=3    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
x3000c0s3b0n0              : ok=3    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
x3000c0s5b0n0              : ok=3    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
</code></pre><p>Execute this step for each unique CFS configuration.</p>
<p><strong>NOTE:</strong> Ensure that the PLAY RECAPs for each session show successes for all
manager NCNs before proceeding.</p>
</li>
<li>
<p>Verify that SAT was successfully configured.</p>
<p>If <code>sat</code> is configured, the <code>--version</code> command will indicate which version
is installed. If <code>sat</code> is not properly configured, the command will fail.</p>
<p><strong>NOTE:</strong> This version number will differ from the version number of the SAT
release distribution. This is the semantic version of the <code>sat</code> Python package,
which is different from the version number of the overall SAT release distribution.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# sat --version
sat 3.7.0
</code></pre><p><strong>NOTE</strong>: Upon first running <code>sat</code>, you may see additional output while the <code>sat</code>
container image is downloaded. This will occur the first time <code>sat</code> is run on
each manager NCN. For example, if you run <code>sat</code> for the first time on <code>ncn-m001</code>
and then for the first time on <code>ncn-m002</code>, you will see this additional output
both times.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">Trying to pull registry.local/cray/cray-sat:3.7.0-20210514024359_9fed037...
Getting image source signatures
Copying blob da64e8df3afc done
Copying blob 0f36fd81d583 done
Copying blob 12527cf455ba done
...
sat 3.7.0
</code></pre></li>
<li>
<p>Stop the typescript.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# exit
</code></pre></li>
</ol>
<p>SAT version <code>2.2.x</code> is now configured:</p>
<ul>
<li>The SAT RPM package is installed on the associated NCNs.</li>
</ul>
<h3 id="next-steps-1">Next Steps</h3>
<p>If other HPE Cray EX software products are being installed or upgraded in conjunction
with SAT, refer to the <a href="https://www.hpe.com/support/ex-gsg"><em>HPE Cray EX System Software Getting Started Guide</em></a>
to determine which step to execute next.</p>
<p>If no other HPE Cray EX software products are being installed or upgraded at this time,
proceed to the remaining <strong>SAT Setup</strong> or <strong>SAT Post-Upgrade</strong> procedures.</p>
<p>If performing a fresh install, execute the <strong>SAT Setup</strong> procedures:</p>
<ul>
<li><a href="/docs-sat/en-23/#sat-authentication">SAT Authentication</a></li>
<li><a href="/docs-sat/en-23/#generate-sat-s3-credentials">Generate SAT S3 Credentials</a></li>
<li><a href="/docs-sat/en-23/#run-sat-setrev-to-set-system-information">Run Sat Setrev to Set System Information</a></li>
</ul>
<p>If performing an upgrade, execute the <strong>SAT Post-Upgrade</strong> procedures:</p>
<ul>
<li><a href="/docs-sat/en-23/#remove-obsolete-configuration-file-sections">Remove obsolete configuration file sections</a></li>
<li><a href="/docs-sat/en-23/#sat-logging">SAT Logging</a></li>
</ul>
<h2 id="sat-authentication">SAT Authentication</h2>
<p>Initially, as part of the installation and configuration, SAT authentication is set up so sat commands can be used in
later steps of the install process. The admin account used to authenticate with <code>sat auth</code> must be enabled in
Keycloak and must have its <em>assigned role</em> set to <em>admin</em>. For instructions on editing <em>Role Mappings</em> see
<em>Create Internal User Accounts in the Keycloak Shasta Realm</em> in the CSM product documentation.
For additional information on SAT authentication, see <em>System Security and Authentication</em> in the CSM
documentation.</p>
<p><strong>NOTE:</strong> This procedure is only required after initially installing SAT. It is not
required after upgrading SAT.</p>
<h3 id="description-of-sat-command-authentication-types">Description of SAT Command Authentication Types</h3>
<p>Some SAT subcommands make requests to the Shasta services through the API gateway and thus require authentication to
the API gateway in order to function. Other SAT subcommands use the Kubernetes API. Some <code>sat</code> commands require S3 to
be configured (see: <a href="/docs-sat/en-23/#generate-sat-s3-credentials">Generate SAT S3 Credentials</a>). In order to use the SAT S3 bucket,
the System Administrator must generate the S3 access key and secret keys and write them to a local file. This must be
done on every Kubernetes manager node where SAT commands are run.</p>
<p>Below is a table describing SAT commands and the types of authentication they require.</p>
<table>
<thead>
<tr>
<th>SAT Subcommand</th>
<th>Authentication/Credentials Required</th>
<th>Man Page</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sat auth</code></td>
<td>Responsible for authenticating to the API gateway and storing a token.</td>
<td><code>sat-auth</code></td>
<td>Authenticate to the API gateway and save the token.</td>
</tr>
<tr>
<td><code>sat bmccreds</code></td>
<td>Requires authentication to the API gateway.</td>
<td><code>sat-bmccreds</code></td>
<td>Set BMC passwords.</td>
</tr>
<tr>
<td><code>sat bootprep</code></td>
<td>Requires authentication to the API gateway. Requires kubernetes configuration and authentication, which is done on ncn-m001 during the install.</td>
<td><code>sat-bootprep</code></td>
<td>Prepare to boot nodes with images and configurations.</td>
</tr>
<tr>
<td><code>sat bootsys</code></td>
<td>Requires authentication to the API gateway. Requires kubernetes configuration and authentication, which is configured on <code>ncn-m001</code> during the install. Some stages require passwordless SSH to be configured to all other NCNs. Requires S3 to be configured for some stages.</td>
<td><code>sat-bootsys</code></td>
<td>Boot or shutdown the system, including compute nodes, application nodes, and non-compute nodes (NCNs) running the management software.</td>
</tr>
<tr>
<td><code>sat diag</code></td>
<td>Requires authentication to the API gateway.</td>
<td><code>sat-diag</code></td>
<td>Launch diagnostics on the HSN switches and generate a report.</td>
</tr>
<tr>
<td><code>sat firmware</code></td>
<td>Requires authentication to the API gateway.</td>
<td><code>sat-firmware</code></td>
<td>Report firmware version.</td>
</tr>
<tr>
<td><code>sat hwhist</code></td>
<td>Requires authentication to the API gateway.</td>
<td><code>sat-hwhist</code></td>
<td>Report hardware component history.</td>
</tr>
<tr>
<td><code>sat hwinv</code></td>
<td>Requires authentication to the API gateway.</td>
<td><code>sat-hwinv</code></td>
<td>Give a listing of the hardware of the HPE Cray EX system.</td>
</tr>
<tr>
<td><code>sat hwmatch</code></td>
<td>Requires authentication to the API gateway.</td>
<td><code>sat-hwmatch</code></td>
<td>Report hardware mismatches.</td>
</tr>
<tr>
<td><code>sat init</code></td>
<td>None</td>
<td><code>sat-init</code></td>
<td>Create a default SAT configuration file.</td>
</tr>
<tr>
<td><code>sat k8s</code></td>
<td>Requires kubernetes configuration and authentication, which is automatically configured on ncn-w001 during the install.</td>
<td><code>sat-k8s</code></td>
<td>Report on kubernetes replicasets that have co-located replicas (i.e. replicas on the same node).</td>
</tr>
<tr>
<td><code>sat linkhealth</code></td>
<td></td>
<td></td>
<td><strong>This command has been deprecated.</strong></td>
</tr>
<tr>
<td><code>sat nid2xname</code></td>
<td>Requires authentication to the API gateway.</td>
<td><code>sat-nid2xname</code></td>
<td>Translate node IDs to node xnames.</td>
</tr>
<tr>
<td><code>sat sensors</code></td>
<td>Requires authentication to the API gateway.</td>
<td><code>sat-sensors</code></td>
<td>Report current sensor data.</td>
</tr>
<tr>
<td><code>sat setrev</code></td>
<td>Requires S3 to be configured for site information such as system name, serial number, install date, and site name.</td>
<td><code>sat-setrev</code></td>
<td>Set HPE Cray EX system revision information.</td>
</tr>
<tr>
<td><code>sat showrev</code></td>
<td>Requires API gateway authentication in order to query the Interconnect from HSM. Requires S3 to be configured for site information such as system name, serial number, install date, and site name.</td>
<td><code>sat-showrev</code></td>
<td>Print revision information for the HPE Cray EX system.</td>
</tr>
<tr>
<td><code>sat slscheck</code></td>
<td>Requires authentication to the API gateway.</td>
<td><code>sat-slscheck</code></td>
<td>Perform a cross-check between SLS and HSM.</td>
</tr>
<tr>
<td><code>sat status</code></td>
<td>Requires authentication to the API gateway.</td>
<td><code>sat-status</code></td>
<td>Report node status across the HPE Cray EX system.</td>
</tr>
<tr>
<td><code>sat swap</code></td>
<td>Requires authentication to the API gateway.</td>
<td><code>sat-swap</code></td>
<td>Prepare HSN switch or cable for replacement and bring HSN switch or cable into service.</td>
</tr>
<tr>
<td><code>sat xname2nid</code></td>
<td>Requires authentication to the API gateway.</td>
<td><code>sat-xname2nid</code></td>
<td>Translate node and node BMC xnames to node IDs.</td>
</tr>
<tr>
<td><code>sat switch</code></td>
<td><strong>This command has been deprecated.</strong> It has been replaced by <code>sat swap</code>.</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>In order to authenticate to the API gateway, you must run the <code>sat auth</code> command. This command will prompt for a password
on the command line. The username value is obtained from the following locations, in order of higher precedence to lower
precedence:</p>
<ul>
<li>The <code>--username</code> global command-line option.</li>
<li>The <code>username</code> option in the <code>api_gateway</code> section of the config file at <code>~/.config/sat/sat.toml</code>.</li>
<li>The name of currently logged in user running the <code>sat</code> command.</li>
</ul>
<p>If credentials are entered correctly when prompted by <code>sat auth</code>, a token file will be obtained and saved to
<code>~/.config/sat/tokens</code>. Subsequent sat commands will determine the username the same way as <code>sat auth</code> described above,
and will use the token for that username if it has been obtained and saved by <code>sat auth</code>.</p>
<h3 id="prerequisites-2">Prerequisites</h3>
<ul>
<li>The <code>sat</code> CLI has been installed following <a href="/docs-sat/en-23/#install-the-system-admin-toolkit-product-stream">Install The System Admin Toolkit Product Stream</a>.</li>
</ul>
<h3 id="procedure-1">Procedure</h3>
<p>The following is the procedure to globally configure the username used by SAT and authenticate to the API gateway:</p>
<ol>
<li>
<p>Generate a default SAT configuration file, if one does not exist.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# sat init
Configuration file &#34;/root/.config/sat/sat.toml&#34; generated.
</code></pre><p><strong>Note:</strong> If the config file already exists, it will print out an error:</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ERROR: Configuration file &#34;/root/.config/sat/sat.toml&#34; already exists.
Not generating configuration file.
</code></pre></li>
<li>
<p>Edit <code>~/.config/sat/sat.toml</code> and set the username option in the <code>api_gateway</code> section of the config file. E.g.:</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">username = &#34;crayadmin&#34;
</code></pre></li>
<li>
<p>Run <code>sat auth</code>. Enter your password when prompted. E.g.:</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# sat auth
Password for crayadmin:
Succeeded!
</code></pre></li>
<li>
<p>Other <code>sat</code> commands are now authenticated to make requests to the API gateway. E.g.:</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# sat status
</code></pre></li>
</ol>
<h2 id="generate-sat-s3-credentials">Generate SAT S3 Credentials</h2>
<p>Generate S3 credentials and write them to a local file so the SAT user can access S3 storage. In order to use the SAT
S3 bucket, the System Administrator must generate the S3 access key and secret keys and write them to a local file.
This must be done on every Kubernetes master node where SAT commands are run.</p>
<p>SAT uses S3 storage for several purposes, most importantly to store the site-specific information set with <code>sat setrev</code>
(see: <a href="/docs-sat/en-23/#run-sat-setrev-to-set-system-information">Run Sat Setrev to Set System Information</a>).</p>
<p><strong>NOTE:</strong> This procedure is only required after initially installing SAT. It is not
required after upgrading SAT.</p>
<h3 id="prerequisites-3">Prerequisites</h3>
<ul>
<li>The SAT CLI has been installed following <a href="/docs-sat/en-23/#install-the-system-admin-toolkit-product-stream">Install The System Admin Toolkit Product Stream</a></li>
<li>The SAT configuration file has been created (See <a href="/docs-sat/en-23/#sat-authentication">SAT Authentication</a>).</li>
<li>CSM has been installed and verified.</li>
</ul>
<h3 id="procedure-2">Procedure</h3>
<ol>
<li>
<p>Ensure the files are readable only by <code>root</code>.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# touch /root/.config/sat/s3_access_key \
    /root/.config/sat/s3_secret_key
</code></pre><pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# chmod 600 /root/.config/sat/s3_access_key \
    /root/.config/sat/s3_secret_key
</code></pre></li>
<li>
<p>Write the credentials to local files using <code>kubectl</code>.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# kubectl get secret sat-s3-credentials -o json -o \
    jsonpath=&#39;{.data.access_key}&#39; | base64 -d &gt; \
    /root/.config/sat/s3_access_key
</code></pre><pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# kubectl get secret sat-s3-credentials -o json -o \
    jsonpath=&#39;{.data.secret_key}&#39; | base64 -d &gt; \
    /root/.config/sat/s3_secret_key
</code></pre></li>
<li>
<p>Verify the S3 endpoint specified in the SAT configuration file is correct.</p>
<ol>
<li>
<p>Get the SAT configuration file&rsquo;s endpoint value.</p>
<p><strong>NOTE:</strong> If the command&rsquo;s output is commented out, indicated by an initial #
character, the SAT configuration will take the default value â€“ <code>&quot;https://rgw-vip.nmn&quot;</code>.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# grep endpoint ~/.config/sat/sat.toml
# endpoint = &#34;https://rgw-vip.nmn&#34;
</code></pre></li>
<li>
<p>Get the <code>sat-s3-credentials</code> secret&rsquo;s endpoint value.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# kubectl get secret sat-s3-credentials -o json -o \
    jsonpath=&#39;{.data.s3_endpoint}&#39; | base64 -d | xargs
https://rgw-vip.nmn
</code></pre></li>
<li>
<p>Compare the two endpoint values.</p>
<p>If the values differ, change the SAT configuration file&rsquo;s endpoint value to match the secret&rsquo;s.</p>
</li>
</ol>
</li>
<li>
<p>Copy SAT configurations to each manager node on the system.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# for i in ncn-m002 ncn-m003; do echo $i; ssh ${i} \
    mkdir -p /root/.config/sat; \
    scp -pr /root/.config/sat ${i}:/root/.config; done
</code></pre><p><strong>NOTE</strong>: Depending on how many manager nodes are on the system, the list of manager nodes may
be different. This example assumes three manager nodes, where the configuration files must be
copied from ncn-m001 to ncn-m002 and ncn-m003. Therefore, the list of hosts above is ncn-m002
and ncn-m003.</p>
</li>
</ol>
<h2 id="run-sat-setrev-to-set-system-information">Run sat setrev to Set System Information</h2>
<p><strong>NOTE:</strong> This procedure is only required after initially installing SAT. It is not
required after upgrading SAT.</p>
<h3 id="prerequisites-4">Prerequisites</h3>
<ul>
<li>S3 credentials have been generated. See <a href="/docs-sat/en-23/#generate-sat-s3-credentials">Generate SAT S3 Credentials</a>.</li>
<li>SAT authentication has been set up. See <a href="/docs-sat/en-23/#sat-authentication">SAT Authentication</a>.</li>
</ul>
<h3 id="procedure-3">Procedure</h3>
<ol>
<li>
<p>Run <code>sat setrev</code> to set System Revision Information. Follow the on-screen prompts to set
the following site-specific values:</p>
<ul>
<li>Serial number</li>
<li>System name</li>
<li>System type</li>
<li>System description</li>
<li>Product number</li>
<li>Company name</li>
<li>Site name</li>
<li>Country code</li>
<li>System install date</li>
</ul>
<p><strong>TIP</strong>: For &ldquo;System type&rdquo;, a system with <em>any</em> liquid-cooled components should be
considered a liquid-cooled system. I.e., &ldquo;System type&rdquo; is EX-1C.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# sat setrev
--------------------------------------------------------------------------------
Setting:        Serial number
Purpose:        System identification. This will affect how snapshots are
                identified in the HPE backend services.
Description:    This is the top-level serial number which uniquely identifies
                the system. It can be requested from an HPE representative.
Valid values:   Alpha-numeric string, 4 - 20 characters.
Type:           &lt;class &#39;str&#39;&gt;
Default:        None
Current value:  None
--------------------------------------------------------------------------------
Please do one of the following to set the value of the above setting:
    - Input a new value
    - Press CTRL-C to exit
...
</code></pre></li>
<li>
<p>Run <code>sat showrev</code> to verify System Revision Information. The following tables contain example information.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# sat showrev
################################################################################
System Revision Information
################################################################################
+---------------------+---------------+
| component           | data          |
+---------------------+---------------+
| Company name        | HPE           |
| Country code        | US            |
| Interconnect        | Sling         |
| Product number      | R4K98A        |
| Serial number       | 12345         |
| Site name           | HPE           |
| Slurm version       | slurm 20.02.5 |
| System description  | Test System   |
| System install date | 2021-01-29    |
| System name         | eniac         |
| System type         | EX-1C         |
+---------------------+---------------+
################################################################################
Product Revision Information
################################################################################
+--------------+-----------------+------------------------------+------------------------------+
| product_name | product_version | images                       | image_recipes                |
+--------------+-----------------+------------------------------+------------------------------+
| csm          | 0.8.14          | cray-shasta-csm-sles15sp1... | cray-shasta-csm-sles15sp1... |
| sat          | 2.0.1           | -                            | -                            |
| sdu          | 1.0.8           | -                            | -                            |
| slingshot    | 0.8.0           | -                            | -                            |
| sma          | 1.4.12          | -                            | -                            |
+--------------+-----------------+------------------------------+------------------------------+
################################################################################
Local Host Operating System
################################################################################
+-----------+----------------------+
| component | version              |
+-----------+----------------------+
| Kernel    | 5.3.18-24.15-default |
| SLES      | SLES 15-SP2          |
+-----------+----------------------+
</code></pre></li>
</ol>
<h2 id="remove-obsolete-configuration-file-sections">Remove obsolete configuration file sections</h2>
<h3 id="prerequisites-5">Prerequisites</h3>
<ul>
<li>The <a href="/docs-sat/en-23/#install-the-system-admin-toolkit-product-stream">Install the System Admin Toolkit Product Stream</a>
procedure has been successfully completed.</li>
<li>The <a href="/docs-sat/en-23/#perform-ncn-personalization">Perform NCN Personalization</a> procedure has been successfully completed.</li>
</ul>
<h3 id="procedure-4">Procedure</h3>
<p>After upgrading SAT, if using the configuration file from a previous version, there may be
configuration file sections no longer used in the new version. For example, when upgrading
from Shasta 1.4 to Shasta 1.5, the <code>[redfish]</code> configuration file section is no longer used.
In that case, the following warning may appear upon running <code>sat</code> commands.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">WARNING: Ignoring unknown section &#39;redfish&#39; in config file.
</code></pre><p>Remove the <code>[redfish]</code> section from <code>/root/.config/sat/sat.toml</code> to resolve the warning.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">[redfish]
username = &#34;admin&#34;
password = &#34;adminpass&#34;
</code></pre><p>Repeat this process for any configuration file sections for which there are &ldquo;unknown section&rdquo; warnings.</p>
<h2 id="sat-logging">SAT Logging</h2>
<p>As of SAT version 2.2, some command output that was previously printed to <code>stdout</code>
is now logged to <code>stderr</code>. These messages are logged at the <code>INFO</code> level. The
default logging threshold was changed from <code>WARNING</code> to <code>INFO</code> to accomodate
this logging change. Additionally, some messages previously logged at the <code>INFO</code>
are now logged at the <code>DEBUG</code> level.</p>
<p>These changes take effect automatically. However, if the default output threshold
has been manually set in <code>~/.config/sat/sat.toml</code>, it should be changed to ensure
that important output is shown in the terminal.</p>
<h3 id="update-configuration">Update Configuration</h3>
<p>In the following example, the stderr log level, <code>logging.stderr_level</code>, is set to
<code>WARNING</code>, which will exclude <code>INFO</code>-level logging from terminal output.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001:~ # grep -A 3 logging ~/.config/sat/sat.toml
[logging]
...
stderr_level = &#34;WARNING&#34;
</code></pre><p>To enable the new default behavior, comment this line out, delete it, or set
the value to &ldquo;INFO&rdquo;.</p>
<p>If <code>logging.stderr_level</code> is commented out, its value will not affect logging
behavior. However, it may be helpful set its value to <code>INFO</code> as a reminder of
the new default behavior.</p>
<h3 id="affected-commands">Affected Commands</h3>
<p>The following commands trigger messages that have been changed from <code>stdout</code>
print calls to <code>INFO</code>-level (or <code>WARNING</code>- or <code>ERROR</code>-level) log messages:</p>
<pre tabindex="0"><code>sat bootsys --stage shutdown --stage session-checks
sat sensors
</code></pre><p>The following commands trigger messages that have been changed from <code>INFO</code>-level
log messages to <code>DEBUG</code>-level log messages:</p>
<pre tabindex="0"><code>sat nid2xname
sat xname2nid
sat swap
</code></pre><h2 id="uninstall-removing-a-version-of-sat">Uninstall: Removing a Version of SAT</h2>
<h3 id="prerequisites-6">Prerequisites</h3>
<ul>
<li>Only versions 2.2 or newer of SAT can be uninstalled with <code>prodmgr</code>.</li>
<li>CSM version 1.2 or newer must be installed, so that the <code>prodmgr</code> command is available.</li>
</ul>
<h3 id="procedure-5">Procedure</h3>
<ol>
<li>
<p>Use <code>sat showrev</code> to list versions of SAT.</p>
<p><strong>NOTE</strong>: It is not recommended to uninstall a version designated as &ldquo;active&rdquo;.
If the active version is uninstalled, then the activate procedure must be executed
on a remaining version.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# sat showrev --products --filter product_name=sat
###############################################################################
Product Revision Information
###############################################################################
+--------------+-----------------+--------+-------------------+-----------------------+
| product_name | product_version | active | images            | image_recipes         |
+--------------+-----------------+--------+-------------------+-----------------------+
| sat          | 2.3.3           | True   | -                 | -                     |
| sat          | 2.2.10          | False  | -                 | -                     |
+--------------+-----------------+--------+-------------------+-----------------------+
</code></pre></li>
<li>
<p>Use <code>prodmgr</code> to uninstall a version of SAT.</p>
<p>This command will do three things:</p>
<ul>
<li>Remove all hosted-type package repositories associated with the given version of SAT. Group-type
repositories are not removed.</li>
<li>Remove all container images associated with the given version of SAT.</li>
<li>Remove SAT from the <code>cray-product-catalog</code> Kubernetes ConfigMap, so that it will no longer show up
in the output of <code>sat showrev</code>.</li>
</ul>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# prodmgr uninstall sat 2.2.10
Repository sat-2.2.10-sle-15sp2 has been removed.
Removed Docker image cray/cray-sat:3.9.0
Removed Docker image cray/sat-cfs-install:1.0.2
Removed Docker image cray/sat-install-utility:1.4.0
Deleted sat-2.2.10 from product catalog.
</code></pre></li>
</ol>
<h2 id="activate-switching-between-versions">Activate: Switching Between Versions</h2>
<p>This procedure can be used to downgrade the active version of SAT.</p>
<h3 id="prerequisites-7">Prerequisites</h3>
<ul>
<li>Only versions 2.2 or newer of SAT can be activated. Older versions must be activated manually.</li>
<li>CSM version 1.2 or newer must be installed, so that the <code>prodmgr</code> command is available.</li>
</ul>
<h3 id="procedure-6">Procedure</h3>
<ol>
<li>
<p>Use <code>sat showrev</code> to list versions of SAT.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# sat showrev --products --filter product_name=sat
###############################################################################
Product Revision Information
###############################################################################
+--------------+-----------------+--------+--------------------+-----------------------+
| product_name | product_version | active | images             | image_recipes         |
+--------------+-----------------+--------+--------------------+-----------------------+
| sat          | 2.3.3           | True   | -                  | -                     |
| sat          | 2.2.10          | False  | -                  | -                     |
+--------------+-----------------+--------+--------------------+-----------------------+
</code></pre></li>
<li>
<p>Use <code>prodmgr</code> to activate a different version of SAT.</p>
<p>This command will do three things:</p>
<ul>
<li>For all hosted-type package repositories associated with this version of SAT, set them as the sole member
of their corresponding group-type repository. For example, activating SAT version <code>2.2.10</code>
sets the repository <code>sat-2.2.10-sle-15sp2</code> as the only member of the <code>sat-sle-15sp2</code> group.</li>
<li>Set the version <code>2.2.10</code> as active within the product catalog, so that it appears active in the output of
<code>sat showrev</code>.</li>
<li>Ensure that the SAT CFS configuration content exists as a layer in all CFS configurations that are
associated with NCNs with the role &ldquo;Management&rdquo; and subrole &ldquo;Master&rdquo; (for example, the CFS configuration
<code>ncn-personalization</code>). Specifically, it will ensure that the layer refers to the version of SAT CFS
configuration content associated with the version of SAT being activated.</li>
</ul>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# prodmgr activate sat 2.2.10
Repository sat-2.2.10-sle-15sp2 is now the default in sat-sle-15sp2.
Set sat-2.2.10 as active in product catalog.
Updated CFS configurations: [ncn-personalization]
</code></pre></li>
<li>
<p>Verify that the chosen version is marked as active.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# sat showrev --products --filter product_name=sat
###############################################################################
Product Revision Information
###############################################################################
+--------------+-----------------+--------+--------------------+-----------------------+
| product_name | product_version | active | images             | image_recipes         |
+--------------+-----------------+--------+--------------------+-----------------------+
| sat          | 2.3.3           | False  | -                  | -                     |
| sat          | 2.2.10          | True   | -                  | -                     |
+--------------+-----------------+--------+--------------------+-----------------------+
</code></pre></li>
<li>
<p>Run NCN Personalization.</p>
<p>At this point, the command has modified Nexus package repositories to set a particular package repository
as active, but no packages on the NCNs have been changed. In order to complete the activation process,
NCN Personalization must be executed to change the <code>cray-sat-podman</code> package version on the manager NCNs.</p>
<p><strong>NOTE</strong>: Refer to the command output from step 2 for the names of <em>all</em> CFS configurations that were updated,
which may not necessarily be just <code>ncn-personalization</code>. If multiple configurations were updated in step 2, then
a <code>cray cfs sessions create</code> command should be run for each of them. This example assumes a single configuration
named <code>ncn-personalization</code> was updated. If multiple were updated, set <code>cfs_configurations</code> to a space-separated
list below.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# cfs_configurations=&#34;ncn-personalization&#34;
ncn-m001# for cfs_configuration in ${cfs_configurations}
do cray cfs sessions create --name &#34;sat-session-${cfs_configuration}&#34; --configuration-name \
    &#34;${cfs_configuration}&#34; --configuration-limit sat-ncn;
done
</code></pre></li>
<li>
<p>Monitor the progress of each CFS session.</p>
<p>This step assumes a single session named <code>sat-session-ncn-personalization</code> was created in the previous step.</p>
<p>First, list all containers associated with the CFS session:</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# kubectl get pod -n services --selector=cfsession=sat-session-ncn-personalization \
    -o json | jq &#39;.items[0].spec.containers[] | .name&#39;
&#34;inventory&#34;
&#34;ansible-1&#34;
&#34;istio-proxy&#34;
</code></pre><p>Next, get the logs for the <code>ansible-1</code> container.</p>
<p><strong>NOTE:</strong> the trailing digit might differ from &ldquo;1&rdquo;. It is the zero-based
index of the <code>sat-ncn</code> layer within the configuration&rsquo;s layers.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# kubectl logs -c ansible-1 --tail 100 -f -n services \
    --selector=cfsession=sat-session-ncn-personalization
</code></pre><p>Ansible plays, which are run by the CFS session, will install SAT on all the
manager NCNs on the system. Successful results for all of the manager NCN xnames
can be found at the end of the container log. For example:</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">...
PLAY RECAP *********************************************************************
x3000c0s1b0n0              : ok=3    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
x3000c0s3b0n0              : ok=3    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
x3000c0s5b0n0              : ok=3    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
</code></pre><p>Execute this step for each unique CFS configuration.</p>
<p><strong>NOTE:</strong> Ensure that the PLAY RECAPs for each session show successes for all
manager NCNs before proceeding.</p>
</li>
<li>
<p>Verify the new version of the SAT CLI.</p>
<p><strong>NOTE:</strong> This version number will differ from the version number of the SAT
release distribution. This is the semantic version of the SAT Python package,
which is different from the version number of the overall SAT release distribution.</p>
<pre tabindex="0"><code class="language-screen" data-lang="screen">ncn-m001# sat --version
3.9.0
</code></pre></li>
</ol>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/docs-sat/js/clipboard.min.js?1729740967"></script>
    <script src="/docs-sat/js/perfect-scrollbar.min.js?1729740967"></script>
    <script src="/docs-sat/js/perfect-scrollbar.jquery.min.js?1729740967"></script>
    <script src="/docs-sat/js/jquery.sticky.js?1729740967"></script>
    <script src="/docs-sat/js/featherlight.min.js?1729740967"></script>
    <script src="/docs-sat/js/highlight.pack.js?1729740967"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/docs-sat/js/modernizr.custom-3.6.0.js?1729740967"></script>
    <script src="/docs-sat/js/learn.js?1729740967"></script>
    <script src="/docs-sat/js/hugo-learn.js?1729740967"></script>
    
        
            <script src="/docs-sat/mermaid/mermaid.js?1729740967"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

